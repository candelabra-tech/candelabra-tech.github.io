<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–ª–∞—Ä–º –∑–∞ –§–æ–Ω–¥–æ–≤–∏ - –ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏</title>
  <link rel="icon" href="https://candelabra.mk/favicon.ico" type="image/x-icon">
  <link rel="icon" href="https://candelabra.mk/favicon-16x16.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet" />
  <!-- Plotly.js CDN - ready for later use -->
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <style>
    :root {
      --bg-primary: #0a0e1a;
      --bg-secondary: #151b2d;
      --bg-card: #1e2642;
      --bg-accent: #2a3655;
      --text-primary: #ffffff;
      --text-secondary: #b8c5d6;
      --text-muted: #8a9bb5;
      --accent-green: #00d4aa;
      --accent-blue: #4a9eff;
      --accent-gold: #f7b801;
      --accent-red: #ff5757;
      --accent-purple: #8b5cf6;
      --border-color: #334566;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Space Grotesk', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      line-height: 1.6;
      scroll-behavior: smooth;
      overflow-x: hidden;
      min-height: 100vh;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-color);
      position: fixed;
      width: 100%;
      z-index: 1000;
    }

    nav .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    nav .logo img { 
      height: 40px;
      filter: brightness(1.2);
    }

    .logo .highlight {
      color: var(--accent-gold);
    }

    nav a {
      color: var(--text-secondary);
      margin-left: 2rem;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      position: relative;
    }

    nav a:hover {
      color: var(--accent-green);
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
      transition: width 0.3s ease;
    }

    nav a:hover::after {
      width: 100%;
    }

    header {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2rem;
      position: relative;
      background: 
        radial-gradient(circle at 20% 80%, rgba(0, 212, 170, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(74, 158, 255, 0.1) 0%, transparent 50%),
        linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      overflow: hidden;
    }

    .financial-grid {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(52, 69, 102, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(52, 69, 102, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      z-index: 0;
    }

    header h1,
    header .brand,
    header p,
    header .stats-bar {
      position: relative;
      z-index: 1;
    }

    header .brand {
      font-size: 3.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    header h1 {
      font-size: 2rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      font-weight: 400;
    }

    header p {
      font-size: 1.1rem;
      color: var(--text-muted);
      max-width: 600px;
      margin-bottom: 2rem;
    }

    .stats-bar {
      display: flex;
      gap: 3rem;
      margin-top: 2rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .section {
      padding: 5rem 2rem;
      max-width: 1400px;
      margin: auto;
    }

    .section-header {
      text-align: center;
      margin-bottom: 4rem;
    }

    .section-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .section-subtitle {
      font-size: 1.1rem;
      color: var(--text-muted);
      max-width: 600px;
      margin: 0 auto;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .chart-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 2rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .chart-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent-green), var(--accent-blue), var(--accent-gold));
    }

    .chart-card:hover {
      transform: translateY(-8px);
      border-color: var(--accent-green);
      box-shadow: 0 20px 40px rgba(0, 212, 170, 0.15);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .chart-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .chart-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-green);
    }

    .chart-change {
      font-size: 0.9rem;
      font-weight: 500;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
    }

    .chart-change.positive {
      color: var(--success);
      background: rgba(16, 185, 129, 0.1);
    }

    .chart-change.negative {
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }

    .chart-placeholder {
      width: 100%;
      height: 300px;
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-accent));
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      font-style: italic;
      position: relative;
    }

    .chart-placeholder::before {
      content: 'üìä';
      font-size: 3rem;
      margin-bottom: 1rem;
      position: absolute;
      top: 30%;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
    }

    .feature-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 2rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      border-color: var(--accent-blue);
      box-shadow: 0 15px 30px rgba(74, 158, 255, 0.15);
    }

    .feature-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .feature-card:nth-child(1) .feature-icon {
      background: linear-gradient(135deg, var(--accent-green), rgba(0, 212, 170, 0.2));
    }

    .feature-card:nth-child(2) .feature-icon {
      background: linear-gradient(135deg, var(--accent-blue), rgba(74, 158, 255, 0.2));
    }

    .feature-card:nth-child(3) .feature-icon {
      background: linear-gradient(135deg, var(--accent-gold), rgba(247, 184, 1, 0.2));
    }

    .feature-card:nth-child(4) .feature-icon {
      background: linear-gradient(135deg, var(--accent-purple), rgba(139, 92, 246, 0.2));
    }

    .feature-card:nth-child(5) .feature-icon {
      background: linear-gradient(135deg, var(--accent-red), rgba(255, 87, 87, 0.2));
    }

    .feature-card:nth-child(6) .feature-icon {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
    }

    .feature-card h3 {
      color: var(--text-primary);
      margin-bottom: 1rem;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .feature-card p {
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .footer {
      text-align: center;
      padding: 3rem 2rem;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
      color: var(--text-muted);
    }

    .cta-button {
      display: inline-block;
      margin-top: 2rem;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--bg-primary);
      background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
      border: none;
      border-radius: 12px;
      text-decoration: none;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .cta-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .cta-button:hover::before {
      left: 100%;
    }

    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 212, 170, 0.3);
    }

    /* Market Status Indicator */
    .market-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    @media (max-width: 768px) {
      nav {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }
      
      nav a {
        margin-left: 1rem;
      }
      
      header .brand {
        font-size: 2.5rem;
      }
      
      header h1 {
        font-size: 1.5rem;
      }
      
      .stats-bar {
        gap: 1.5rem;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .chart-card {
        min-height: 350px;
      }
      
      .section-title {
        font-size: 2rem;
      }
    }

    @media (max-width: 480px) {
      .dashboard-grid,
      .features-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Fund Type Dashboard Styles */
    .fund-type-section {
      margin-bottom: 3rem;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 16px;
      padding: 2rem;
      border: 1px solid rgba(51, 69, 102, 0.3);
    }

    .fund-type-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .fund-type-title {
      color: var(--text-primary);
      font-size: 1.5rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .fund-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .time-filter-btn, .toggle-all-btn {
      padding: 0.5rem 1rem;
      border: 1px solid rgba(51, 69, 102, 0.5);
      background: rgba(30, 41, 59, 0.8);
      color: var(--text-secondary);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .time-filter-btn:hover, .toggle-all-btn:hover {
      background: rgba(51, 69, 102, 0.8);
      border-color: var(--accent-blue);
      color: var(--text-primary);
    }

    .time-filter-btn.active {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    .fund-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      max-width: 600px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.25rem 0.5rem;
      background: rgba(30, 41, 59, 0.6);
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }

    .legend-item:hover {
      background: rgba(51, 69, 102, 0.8);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .legend-item.hidden {
      opacity: 0.5;
      text-decoration: line-through;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    .chart-container {
      background: rgba(30, 41, 59, 0.4);
      border-radius: 12px;
      border: 1px solid rgba(51, 69, 102, 0.3);
      overflow: hidden;
    }

    @media (max-width: 768px) {
      .fund-type-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .fund-controls {
        width: 100%;
        justify-content: space-between;
      }

      .fund-legend {
        max-width: 100%;
      }

      .time-filter-container {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <canvas id="bgCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none;"></canvas>
  
  <nav>
    <div class="logo">
      <img src="../logo.png" alt="Candelabra Logo" />
      <span>–§–æ–Ω–¥<span class="highlight">–ê–ª–∞—Ä–º</span></span>
    </div>
    <div>
      <a href="../index.html">–î–æ–º–∞</a>
      <a href="#notifications">–ò–∑–≤–µ—Å—Ç—É–≤–∞—ö–∞</a>
      <a href="#funds-prices">–¶–µ–Ω–∏ –Ω–∞ –§–æ–Ω–¥–æ–≤–∏</a>
      <a href="#dashboard">–¢–∞–±–ª–∞</a>
      <a href="#about">–ó–∞ –§–æ–Ω–¥–æ–≤–∏—Ç–µ</a>
      <a href="#analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
    </div>
  </nav>

  <header>
    <div class="financial-grid"></div>
    <div class="market-status">
      <div class="status-dot"></div>
      <span>–ü–∞–∑–∞—Ä–∏—Ç–µ –û—Ç–≤–æ—Ä–µ–Ω–∏</span>
    </div>
    <div class="brand">–§–æ–Ω–¥–ê–ª–∞—Ä–º</div>
    <h1>–ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏ - –ê–Ω–∞–ª–∏–∑–∞ –∏ –°–ª–µ–¥–µ—ö–µ</h1>
    <p>–°–ª–µ–¥–µ—ö–µ –Ω–∞ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏—Ç–µ –Ω–∞ –º–∞–∫–µ–¥–æ–Ω—Å–∫–∏—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ —Ñ–æ–Ω–¥–æ–≤–∏ –≤–æ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ —Å–æ –Ω–∞–ø—Ä–µ–¥–Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –ø—Ä–æ—Ü–µ–Ω–∞ –Ω–∞ —Ä–∏–∑–∏–∫ –∏ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∏ –∏–∑–≤–µ—Å—Ç—É–≤–∞—ö–∞ –∑–∞ –æ–ø—Ç–∏–º–∞–ª–Ω–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ –æ–¥–ª—É–∫–∏.</p>
    
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value">147.2 –º–ª–Ω –¥–µ–Ω</div>
        <div class="stat-label">–í–∫—É–ø–Ω–∞ –í—Ä–µ–¥–Ω–æ—Å—Ç</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">+8.4%</div>
        <div class="stat-label">–ì–æ–¥–∏—à–µ–Ω –ü—Ä–∏–Ω–æ—Å</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">12</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∏ –§–æ–Ω–¥–æ–≤–∏</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">11.2%</div>
        <div class="stat-label">–í–æ–ª–∞—Ç–∏–ª–Ω–æ—Å—Ç</div>
      </div>
    </div>
    
    <a class="cta-button" href="#funds-prices">–ü–æ–≥–ª–µ–¥–Ω–∏ –¶–µ–Ω–∏</a>
  </header>

  <!-- Notifications -->
  <section class="section" id="notifications">
    <div class="section-header">
      <h2 class="section-title">üîî –ò–∑–≤–µ—Å—Ç—É–≤–∞—ö–∞</h2>
      <p class="section-subtitle">–§–æ–Ω–¥–æ–≤–∏ —Å–æ –∑–Ω–∞—á–∞—ò–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏ –Ω–∞ —Ü–µ–Ω–∏—Ç–µ: 1%+ –Ω–µ–¥–µ–ª–Ω–æ ‚Ä¢ 5%+ –º–µ—Å–µ—á–Ω–æ ‚Ä¢ 10%+ –∑–∞ 6 –º–µ—Å–µ—Ü–∏</p>
    </div>
    
    <div style="background: var(--bg-card); border-radius: 16px; padding: 2rem; border: 1px solid var(--border-color);">
      <div id="auto-alerts" style="min-height: 200px;">
        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
          <div class="loading-spinner" style="margin: 0 auto 1rem auto;"></div>
          –°–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–∞—Ç –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ü–µ–Ω–∏—Ç–µ...
        </div>
      </div>
    </div>
  </section>

  <!-- Fund Prices Table -->
  <section class="section" id="funds-prices">
    <div class="section-header">
      <h2 class="section-title">–¶–µ–Ω–∏ –Ω–∞ –§–æ–Ω–¥–æ–≤–∏</h2>
      <p class="section-subtitle">–¢–µ–∫–æ–≤–Ω–∏ –ù–ê–í –∏ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏ –Ω–∞ —Å–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω–∏ –º–∞–∫–µ–¥–æ–Ω—Å–∫–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ —Ñ–æ–Ω–¥–æ–≤–∏</p>
    </div>
    
    <div class="table-wrapper" style="background: var(--bg-card); border-radius: 16px; padding: 2rem; border: 1px solid var(--border-color); overflow-x: auto;">
      <table id="funds-table" style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
        <thead>
          <tr style="border-bottom: 2px solid var(--border-color);">
            <th style="text-align: left; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–§–æ–Ω–¥</th>
            <th style="text-align: left; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–¢–∏–ø</th>
            <th style="text-align: right; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–ù–ê–í (–¥–µ–Ω)</th>
            <th style="text-align: right; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–ü—Ä–æ–º–µ–Ω–∞</th>
            <th style="text-align: right; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–î–Ω–µ–≤–Ω–∞ %</th>
            <th style="text-align: right; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–ì–æ–¥–∏—à–Ω–∞ %</th>
            <th style="text-align: right; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–†–∏–∑–∏–∫</th>
            <th style="text-align: center; padding: 1rem; color: var(--accent-gold); font-weight: 600;">–î–∞—Ç—É–º</th>
          </tr>
        </thead>
        <tbody id="funds-table-body">
          <!-- Data will be populated from data_all.csv -->
          <tr>
            <td colspan="8" style="padding: 2rem; text-align: center; color: var(--text-muted);">
              <div class="chart-placeholder">–í—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ —Ñ–æ–Ω–¥–æ–≤–∏—Ç–µ...</div>
            </td>
          </tr>
        </tbody>
      </table>
      
      <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div id="funds-count" style="color: var(--text-muted); font-size: 0.9rem;">
          üìä –í—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏...
        </div>
        <div id="last-updated" style="color: var(--text-muted); font-size: 0.9rem;">
          üïí –ü–æ—Å–ª–µ–¥–Ω–æ –∞–∂—É—Ä–∏—Ä–∞–Ω–æ: –í—á–∏—Ç—É–≤–∞—ö–µ...
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="dashboard">
    <div class="section-header">
      <h2 class="section-title">–¢–∞–±–ª–∞ –∑–∞ –°–ª–µ–¥–µ—ö–µ</h2>
      <p class="section-subtitle">–ê–Ω–∞–ª–∏–∑–∞ –Ω–∞ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏—Ç–µ –ø–æ —Ç–∏–ø–æ–≤–∏ —Ñ–æ–Ω–¥–æ–≤–∏ —Å–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏ –≥—Ä–∞—Ñ–∏–∫–æ–Ω–∏ –∏ –≤—Ä–µ–º–µ–Ω—Å–∫–∏ —Ñ–∏–ª—Ç–µ—Ä–∏</p>
    </div>

    <!-- Global Time Filter -->
    <div style="margin-bottom: 2rem; text-align: center;">
      <div class="time-filter-container" style="display: inline-flex; gap: 0.5rem; padding: 0.5rem; background: rgba(51, 69, 102, 0.3); border-radius: 12px;">
        <button class="time-filter-btn active" data-period="1M">1 –ú–µ—Å–µ—Ü</button>
        <button class="time-filter-btn" data-period="3M">3 –ú–µ—Å–µ—Ü–∏</button>
        <button class="time-filter-btn" data-period="6M">6 –ú–µ—Å–µ—Ü–∏</button>
        <button class="time-filter-btn" data-period="1Y">1 –ì–æ–¥–∏–Ω–∞</button>
        <button class="time-filter-btn" data-period="ALL">–°–∏—Ç–µ</button>
      </div>
    </div>
    
    <!-- Equity Funds Chart -->
    <div class="fund-type-section">
      <div class="fund-type-header">
        <h3 class="fund-type-title">üìà –ê–∫—Ü–∏—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏</h3>
        <div class="fund-controls">
          <button class="toggle-all-btn" data-type="equity">–ü—Ä–∏–∫–∞–∂–∏/–°–æ–∫—Ä–∏—ò –°–∏—Ç–µ</button>
          <div class="fund-legend" id="equity-legend"></div>
        </div>
      </div>
      <div class="chart-container">
        <div id="equity-chart" style="width: 100%; height: 400px;"></div>
      </div>
    </div>

    <!-- Bond Funds Chart -->
    <div class="fund-type-section">
      <div class="fund-type-header">
        <h3 class="fund-type-title">üèõÔ∏è –û–±–≤—Ä–∑–Ω–∏—á–∫–∏ –§–æ–Ω–¥–æ–≤–∏</h3>
        <div class="fund-controls">
          <button class="toggle-all-btn" data-type="bond">–ü—Ä–∏–∫–∞–∂–∏/–°–æ–∫—Ä–∏—ò –°–∏—Ç–µ</button>
          <div class="fund-legend" id="bond-legend"></div>
        </div>
      </div>
      <div class="chart-container">
        <div id="bond-chart" style="width: 100%; height: 400px;"></div>
      </div>
    </div>

    <!-- Balanced Funds Chart -->
    <div class="fund-type-section">
      <div class="fund-type-header">
        <h3 class="fund-type-title">‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–∏ –§–æ–Ω–¥–æ–≤–∏</h3>
        <div class="fund-controls">
          <button class="toggle-all-btn" data-type="balanced">–ü—Ä–∏–∫–∞–∂–∏/–°–æ–∫—Ä–∏—ò –°–∏—Ç–µ</button>
          <div class="fund-legend" id="balanced-legend"></div>
        </div>
      </div>
      <div class="chart-container">
        <div id="balanced-chart" style="width: 100%; height: 400px;"></div>
      </div>
    </div>

    <!-- Money Market Funds Chart -->
    <div class="fund-type-section">
      <div class="fund-type-header">
        <h3 class="fund-type-title">üí∞ –ü–∞—Ä–∏—á–Ω–∏ –§–æ–Ω–¥–æ–≤–∏</h3>
        <div class="fund-controls">
          <button class="toggle-all-btn" data-type="money">–ü—Ä–∏–∫–∞–∂–∏/–°–æ–∫—Ä–∏—ò –°–∏—Ç–µ</button>
          <div class="fund-legend" id="money-legend"></div>
        </div>
      </div>
      <div class="chart-container">
        <div id="money-chart" style="width: 100%; height: 400px;"></div>
      </div>
    </div>
  </section>

  <!-- Sectoral Funds -->
  <section class="fund-type-section">
    <div class="fund-type-header">
      <div class="fund-type-title">
        <span class="fund-type-icon">üè≠</span>
        <h2>–°–µ–∫—Ç–æ—Ä—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏</h2>
        <span class="fund-count" id="sectoral-count">0 —Ñ–æ–Ω–¥–æ–≤–∏</span>
      </div>
      <div class="time-filters">
        <button class="time-filter-btn active" data-period="1M">1–ú</button>
        <button class="time-filter-btn" data-period="3M">3–ú</button>
        <button class="time-filter-btn" data-period="6M">6–ú</button>
        <button class="time-filter-btn" data-period="1Y">1–ì</button>
        <button class="time-filter-btn" data-period="ALL">–°–ò–¢</button>
      </div>
    </div>
    <div class="fund-type-content">
      <div class="fund-info">
        <h3>–°–ø–µ—Ü–∏—ò–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ —Ñ–æ–Ω–¥–æ–≤–∏ —à—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ä–∞–∞—Ç –≤–æ –æ–¥—Ä–µ–¥–µ–Ω–∏ —Å–µ–∫—Ç–æ—Ä–∏</h3>
        <p>–§–æ–Ω–¥–æ–≤–∏ –∫–æ–∏ —Å–µ —Ñ–æ–∫—É—Å–∏—Ä–∞–∞—Ç –Ω–∞ –æ–¥—Ä–µ–¥–µ–Ω–∏ —Å–µ–∫—Ç–æ—Ä–∏ –∫–∞–∫–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—ò–∞, —Ñ–∏–Ω–∞–Ω—Å–∏–∏, –µ–Ω–µ—Ä–≥–∏—ò–∞ –∏ –µ—Ç–∏—á–∫–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ä–∞—ö–µ.</p>
        <div class="fund-controls">
          <button class="toggle-all-btn" data-type="sectoral">–ü—Ä–∏–∫–∞–∂–∏/–°–æ–∫—Ä–∏—ò –°–∏—Ç–µ</button>
          <div class="fund-legend" id="sectoral-legend"></div>
        </div>
      </div>
      <div class="chart-container">
        <div id="sectoral-chart" style="width: 100%; height: 400px;"></div>
      </div>
    </div>
  </section>

  <!-- Index Funds -->
  <section class="fund-type-section">
    <div class="fund-type-header">
      <div class="fund-type-title">
        <span class="fund-type-icon">üìä</span>
        <h2>–ò–Ω–¥–µ–∫—Å–Ω–∏ –§–æ–Ω–¥–æ–≤–∏</h2>
        <span class="fund-count" id="index-count">0 —Ñ–æ–Ω–¥–æ–≤–∏</span>
      </div>
      <div class="time-filters">
        <button class="time-filter-btn active" data-period="1M">1–ú</button>
        <button class="time-filter-btn" data-period="3M">3–ú</button>
        <button class="time-filter-btn" data-period="6M">6–ú</button>
        <button class="time-filter-btn" data-period="1Y">1–ì</button>
        <button class="time-filter-btn" data-period="ALL">–°–ò–¢</button>
      </div>
    </div>
    <div class="fund-type-content">
      <div class="fund-info">
        <h3>–§–æ–Ω–¥–æ–≤–∏ –∫–æ–∏ —Å–ª–µ–¥–∞—Ç –∏–Ω–¥–µ–∫—Å–∏ –∏ –ø–∞–∑–∞—Ä–Ω–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
        <p>–ü–∞—Å–∏–≤–Ω–∏ —Ñ–æ–Ω–¥–æ–≤–∏ –∫–æ–∏ —Å–µ –¥–∏–∑–∞—ò–Ω–∏—Ä–∞–Ω–∏ –¥–∞ –≥–∏ —Å–ª–µ–¥–∞—Ç –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏—Ç–µ –Ω–∞ –æ–¥—Ä–µ–¥–µ–Ω–∏ –ø–∞–∑–∞—Ä–Ω–∏ –∏–Ω–¥–µ–∫—Å–∏.</p>
        <div class="fund-controls">
          <button class="toggle-all-btn" data-type="index">–ü—Ä–∏–∫–∞–∂–∏/–°–æ–∫—Ä–∏—ò –°–∏—Ç–µ</button>
          <div class="fund-legend" id="index-legend"></div>
        </div>
      </div>
      <div class="chart-container">
        <div id="index-chart" style="width: 100%; height: 400px;"></div>
      </div>
    </div>
  </section>

  <!-- Fund Distribution Section -->
  <section class="section" id="fund-distribution">
    <div class="section-header">
      <h2 class="section-title">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞ –Ω–∞ –§–æ–Ω–¥–æ–≤–∏</h2>
      <p class="section-subtitle">–ê–Ω–∞–ª–∏–∑–∞ –Ω–∞ –≤–∫—É–ø–Ω–∏—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ —Ç–∏–ø –Ω–∞ —Ñ–æ–Ω–¥ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞ –º–µ—ì—É –ø–æ–µ–¥–∏–Ω–µ—á–Ω–∏ —Ñ–æ–Ω–¥–æ–≤–∏</p>
    </div>
    
    <div style="display: grid; gap: 2rem; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); margin-bottom: 2rem;" class="distribution-grid">
      
      <!-- Fund Types Distribution -->
      <div style="background: var(--bg-card); border-radius: 16px; padding: 2rem; border: 1px solid var(--border-color);">
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
          <h3 style="color: var(--accent-gold); margin: 0; font-size: 1.3rem;">üè¶ –†–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞ –ø–æ –¢–∏–ø</h3>
          <div style="background: var(--accent-teal); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 600;" id="total-funds-badge">
            24 –§–æ–Ω–¥–æ–≤–∏
          </div>
        </div>
        <div id="fund-types-chart" style="height: 350px;"></div>
        <div id="fund-types-summary" style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-muted);">
          –°–µ –≤—á–∏—Ç—É–≤–∞–∞—Ç –ø–æ–¥–∞—Ç–æ—Ü–∏...
        </div>
      </div>

      <!-- Fund Type Summary -->
      <div style="background: var(--bg-card); border-radius: 16px; padding: 2rem; border: 1px solid var(--border-color);">
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
          <h3 style="color: var(--accent-gold); margin: 0; font-size: 1.3rem;">ÔøΩ –í–∫—É–ø–Ω–∞ –í—Ä–µ–¥–Ω–æ—Å—Ç</h3>
          <div style="background: var(--accent-blue); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 600;" id="total-value-badge">
            –í—á–∏—Ç—É–≤–∞—ö–µ...
          </div>
        </div>
        <div id="fund-summary-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem;">
          –°–µ –≤—á–∏—Ç—É–≤–∞–∞—Ç –ø–æ–¥–∞—Ç–æ—Ü–∏...
        </div>
      </div>

    </div>

    <!-- Individual Fund Type Distributions -->
    <div style="margin-bottom: 2rem;">
      <h3 style="color: var(--accent-gold); margin-bottom: 1.5rem; font-size: 1.4rem; text-align: center;">üí∞ –ü–æ–¥–µ–ª–±–∞ –ø–æ –§–æ–Ω–¥ –≤–æ —Å–µ–∫–æ—ò –¢–∏–ø</h3>
      <div style="display: grid; gap: 2rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));" id="fund-type-distributions">
        
        <!-- Equity Funds Distribution -->
        <div style="background: var(--bg-card); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border-color); border-left: 4px solid #10b981;">
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <span style="font-size: 1.4rem;">üìà</span>
            <h4 style="color: var(--text-primary); margin: 0; font-size: 1.1rem;">–ê–∫—Ü–∏—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏</h4>
            <div style="background: #10b981; color: white; padding: 0.2rem 0.6rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;" id="equity-count-badge">0</div>
          </div>
          <div id="equity-distribution-chart" style="height: 250px;"></div>
          <div id="equity-distribution-summary" style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
            –í—á–∏—Ç—É–≤–∞—ö–µ...
          </div>
        </div>

        <!-- Bond Funds Distribution -->
        <div style="background: var(--bg-card); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border-color); border-left: 4px solid #3b82f6;">
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <span style="font-size: 1.4rem;">üèõÔ∏è</span>
            <h4 style="color: var(--text-primary); margin: 0; font-size: 1.1rem;">–û–±–≤—Ä–∑–Ω–∏—á–∫–∏ –§–æ–Ω–¥–æ–≤–∏</h4>
            <div style="background: #3b82f6; color: white; padding: 0.2rem 0.6rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;" id="bond-count-badge">0</div>
          </div>
          <div id="bond-distribution-chart" style="height: 250px;"></div>
          <div id="bond-distribution-summary" style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
            –í—á–∏—Ç—É–≤–∞—ö–µ...
          </div>
        </div>

        <!-- Balanced Funds Distribution -->
        <div style="background: var(--bg-card); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border-color); border-left: 4px solid #8b5cf6;">
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <span style="font-size: 1.4rem;">‚öñÔ∏è</span>
            <h4 style="color: var(--text-primary); margin: 0; font-size: 1.1rem;">–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–∏ –§–æ–Ω–¥–æ–≤–∏</h4>
            <div style="background: #8b5cf6; color: white; padding: 0.2rem 0.6rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;" id="balanced-count-badge">0</div>
          </div>
          <div id="balanced-distribution-chart" style="height: 250px;"></div>
          <div id="balanced-distribution-summary" style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
            –í—á–∏—Ç—É–≤–∞—ö–µ...
          </div>
        </div>

        <!-- Money Market Funds Distribution -->
        <div style="background: var(--bg-card); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border-color); border-left: 4px solid #f59e0b;">
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <span style="font-size: 1.4rem;">üí∞</span>
            <h4 style="color: var(--text-primary); margin: 0; font-size: 1.1rem;">–ü–∞—Ä–∏—á–Ω–∏ –§–æ–Ω–¥–æ–≤–∏</h4>
            <div style="background: #f59e0b; color: white; padding: 0.2rem 0.6rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;" id="money-count-badge">0</div>
          </div>
          <div id="money-distribution-chart" style="height: 250px;"></div>
          <div id="money-distribution-summary" style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
            –í—á–∏—Ç—É–≤–∞—ö–µ...
          </div>
        </div>

        <!-- Sectoral Funds Distribution -->
        <div style="background: var(--bg-card); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border-color); border-left: 4px solid #ef4444;">
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <span style="font-size: 1.4rem;">üè≠</span>
            <h4 style="color: var(--text-primary); margin: 0; font-size: 1.1rem;">–°–µ–∫—Ç–æ—Ä—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏</h4>
            <div style="background: #ef4444; color: white; padding: 0.2rem 0.6rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;" id="sectoral-count-badge">0</div>
          </div>
          <div id="sectoral-distribution-chart" style="height: 250px;"></div>
          <div id="sectoral-distribution-summary" style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
            –í—á–∏—Ç—É–≤–∞—ö–µ...
          </div>
        </div>

        <!-- Index Funds Distribution -->
        <div style="background: var(--bg-card); border-radius: 16px; padding: 1.5rem; border: 1px solid var(--border-color); border-left: 4px solid #06b6d4;">
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
            <span style="font-size: 1.4rem;">üìä</span>
            <h4 style="color: var(--text-primary); margin: 0; font-size: 1.1rem;">–ò–Ω–¥–µ–∫—Å–Ω–∏ –§–æ–Ω–¥–æ–≤–∏</h4>
            <div style="background: #06b6d4; color: white; padding: 0.2rem 0.6rem; border-radius: 8px; font-size: 0.75rem; font-weight: 600;" id="index-count-badge">0</div>
          </div>
          <div id="index-distribution-chart" style="height: 250px;"></div>
          <div id="index-distribution-summary" style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
            –í—á–∏—Ç—É–≤–∞—ö–µ...
          </div>
        </div>

      </div>
    </div>

    <!-- Top Performers -->
    <div style="background: var(--bg-card); border-radius: 16px; padding: 2rem; border: 1px solid var(--border-color);">
      <h3 style="color: var(--accent-gold); margin-bottom: 1.5rem; font-size: 1.3rem;">üèÜ –ù–∞—ò–≥–æ–ª–µ–º–∏ –§–æ–Ω–¥–æ–≤–∏ –ø–æ –í—Ä–µ–¥–Ω–æ—Å—Ç</h3>
      <div id="top-funds-list" style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
        –°–µ –≤—á–∏—Ç—É–≤–∞–∞—Ç –ø–æ–¥–∞—Ç–æ—Ü–∏...
      </div>
    </div>
  </section>

  <section class="section" id="about">
    <div class="section-header">
      <h2 class="section-title">–ó–∞ –ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏—Ç–µ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏</h2>
      <p class="section-subtitle">–¶–µ–ª–æ—Å–µ–Ω –ø—Ä–µ–≥–ª–µ–¥ –Ω–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–∏—Ç–µ –º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ –†–µ–ø—É–±–ª–∏–∫–∞ –°–µ–≤–µ—Ä–Ω–∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞</p>
    </div>
    
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">üèõÔ∏è</div>
        <h3>–†–µ–≥—É–ª–∏—Ä–∞–Ω –ü–∞–∑–∞—Ä</h3>
        <p>–°–∏—Ç–µ —Ñ–æ–Ω–¥–æ–≤–∏ —Å–µ —Ä–µ–≥—É–ª–∏—Ä–∞–Ω–∏ –æ–¥ –ö–æ–º–∏—Å–∏—ò–∞—Ç–∞ –∑–∞ —Ö–∞—Ä—Ç–∏–∏ –æ–¥ –≤—Ä–µ–¥–Ω–æ—Å—Ç –∏ –ª–∏—Ü–µ–Ω—Ü–∏—Ä–∞–Ω–∏ —Å–ø–æ—Ä–µ–¥ –º–∞–∫–µ–¥–æ–Ω—Å–∫–æ—Ç–æ –∑–∞–∫–æ–Ω–æ–¥–∞–≤—Å—Ç–≤–æ –∑–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ —Ñ–æ–Ω–¥–æ–≤–∏.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üìä</div>
        <h3>–†–∞–∑–ª–∏—á–Ω–∏ –¢–∏–ø–æ–≤–∏ –§–æ–Ω–¥–æ–≤–∏</h3>
        <p>–°–ª–µ–¥–∏–º–µ –∞–∫—Ü–∏—Å–∫–∏, –æ–±–≤—Ä–∑–Ω–∏—á–∫–∏, –º–µ—à–∞–Ω–∏, –ø–∞—Ä–∏—á–Ω–∏ –∏ –∏–Ω–¥–µ–∫—Å–Ω–∏ —Ñ–æ–Ω–¥–æ–≤–∏.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üí∞</div>
        <h3>–ù–ê–í –°–ª–µ–¥–µ—ö–µ</h3>
        <p>–î–Ω–µ–≤–Ω–æ –∞–∂—É—Ä–∏—Ä–∞—ö–µ –Ω–∞ –ù–µ—Ç–æ –°—Ä–µ–¥—Å—Ç–≤–µ–Ω–∞—Ç–∞ –í—Ä–µ–¥–Ω–æ—Å—Ç (–ù–ê–í) –∑–∞ —Å–µ–∫–æ—ò —Ñ–æ–Ω–¥ —Å–æ –∏—Å—Ç–æ—Ä–∏—Å–∫–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤–∏.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üîç</div>
        <h3>–î–µ—Ç–∞–ª–Ω–∞ –ê–Ω–∞–ª–∏–∑–∞</h3>
        <p>–ö–æ–º–ø–ª–µ—Ç–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏—Ç–µ, —Ä–∏–∑–∏—Ü–∏—Ç–µ –∏ –¥–∏–≤–µ—Ä–∑–∏—Ñ–∏–∫–∞—Ü–∏—ò–∞—Ç–∞.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">‚ö°</div>
        <h3>–†–µ–∞–ª–Ω–∏ –ü–æ–¥–∞—Ç–æ—Ü–∏</h3>
        <p>–ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–µ –∑–µ–º–∞–∞—Ç –¥–∏—Ä–µ–∫—Ç–Ω–æ –æ–¥ –æ—Ñ–∏—Ü–∏—ò–∞–ª–Ω–∏—Ç–µ –∏–∑–≤–æ—Ä–∏ –∏ —Å–µ –∞–∂—É—Ä–∏—Ä–∞–∞—Ç —Ä–µ–¥–æ–≤–Ω–æ –∑–∞ –¥–∞ –æ–±–µ–∑–±–µ–¥–∞—Ç –ø—Ä–µ—Ü–∏–∑–Ω–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üìà</div>
        <h3>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ –£–≤–∏–¥–∏</h3>
        <p>–î–æ–±–∏—ò—Ç–µ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–∏ —É–≤–∏–¥–∏ –∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤–∏—Ç–µ –Ω–∞ –ø–∞–∑–∞—Ä–æ—Ç –∏ –ø—Ä–µ–ø–æ—Ä–∞–∫–∏ –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—ò–∞ –Ω–∞ –≤–∞—à–∏–æ—Ç –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ.</p>
      </div>
    </div>

    <div class="info-section" style="background: var(--bg-card); padding: 3rem; border-radius: 16px; margin: 3rem 0; border: 1px solid var(--border-color);">
      <h3 style="color: var(--accent-gold); margin-bottom: 1.5rem; font-size: 1.5rem;">–ó–æ—à—Ç–æ –¥–∞ –≥–∏ —Å–ª–µ–¥–∏—Ç–µ –º–∞–∫–µ–¥–æ–Ω—Å–∫–∏—Ç–µ —Ñ–æ–Ω–¥–æ–≤–∏?</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; color: var(--text-secondary);">
        <div>
          <h4 style="color: var(--text-primary); margin-bottom: 1rem;">üéØ –õ–æ–∫–∞–ª–Ω–∏ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</h4>
          <p>–ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏—Ç–µ —Ñ–æ–Ω–¥–æ–≤–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ä–∞–∞—Ç –≤–æ –ª–æ–∫–∞–ª–Ω–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ —Ö–∞—Ä—Ç–∏–∏ –æ–¥ –≤—Ä–µ–¥–Ω–æ—Å—Ç, –æ–≤–æ–∑–º–æ–∂—É–≤–∞—ò—ú–∏ –≤–∏ –¥–∞ —É—á–µ—Å—Ç–≤—É–≤–∞—Ç–µ –≤–æ —Ä–∞–∑–≤–æ—ò–æ—Ç –Ω–∞ –¥–æ–º–∞—à–Ω–∞—Ç–∞ –µ–∫–æ–Ω–æ–º–∏—ò–∞.</p>
        </div>
        <div>
          <h4 style="color: var(--text-primary); margin-bottom: 1rem;">üíº –ü—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–æ –£–ø—Ä–∞–≤—É–≤–∞—ö–µ</h4>
          <p>–§–æ–Ω–¥–æ–≤–∏—Ç–µ —Å–µ —É–ø—Ä–∞–≤—É–≤–∞–Ω–∏ –æ–¥ –ª–∏—Ü–µ–Ω—Ü–∏—Ä–∞–Ω–∏ –¥—Ä—É—à—Ç–≤–∞ –∑–∞ —É–ø—Ä–∞–≤—É–≤–∞—ö–µ —Å–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ —Ñ–æ–Ω–¥–æ–≤–∏ —Å–æ –¥–æ–∫–∞–∂–∞–Ω–æ –∏—Å–∫—É—Å—Ç–≤–æ –Ω–∞ –ø–∞–∑–∞—Ä–æ—Ç.</p>
        </div>
        <div>
          <h4 style="color: var(--text-primary); margin-bottom: 1rem;">üõ°Ô∏è –ü—Ä–∞–≤–Ω–∞ –ó–∞—à—Ç–∏—Ç–∞</h4>
          <p>–ò–Ω–≤–µ—Å—Ç–∏—Ç–æ—Ä–∏—Ç–µ —Å–µ –∑–∞—à—Ç–∏—Ç–µ–Ω–∏ —Å–æ –º–∞–∫–µ–¥–æ–Ω—Å–∫–æ—Ç–æ –∑–∞–∫–æ–Ω–æ–¥–∞–≤—Å—Ç–≤–æ –∏ —Å–µ –ø–æ–¥ –Ω–∞–¥–∑–æ—Ä –Ω–∞ —Ä–µ–≥—É–ª–∞—Ç–æ—Ä–Ω–∏—Ç–µ —Ç–µ–ª–∞.</p>
        </div>
        <div>
          <h4 style="color: var(--text-primary); margin-bottom: 1rem;">üìã –¢—Ä–∞–Ω—Å–ø–∞—Ä–µ–Ω—Ç–Ω–æ—Å—Ç</h4>
          <p>–†–µ–¥–æ–≤–Ω–æ –æ–±—ò–∞–≤—É–≤–∞—ö–µ –Ω–∞ –∏–∑–≤–µ—à—Ç–∞–∏, –ù–ê–í –∏ —Å–æ—Å—Ç–∞–≤ –Ω–∞ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ—Ç–æ —Å–ø–æ—Ä–µ–¥ —Ä–µ–≥—É–ª–∞—Ç–æ—Ä–Ω–∏—Ç–µ –±–∞—Ä–∞—ö–∞.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="analytics">
    <div class="section-header">
      <h2 class="section-title">–ù–∞–ø—Ä–µ–¥–Ω–∞ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
      <p class="section-subtitle">–ü—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–∏ –∞–ª–∞—Ç–∫–∏ –∑–∞ —Ü–µ–ª–æ—Å–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—ò–∞ –Ω–∞ —Ñ–æ–Ω–¥–æ–≤–∏—Ç–µ</p>
    </div>
    
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">üìä</div>
        <h3>–ü–æ–¥–∞—Ç–æ—Ü–∏ –≤–æ –†–µ–∞–ª–Ω–æ –í—Ä–µ–º–µ</h3>
        <p>–ü—Ä–∏—Å—Ç–∞–ø –¥–æ –∂–∏–≤–∏ –ø–∞–∑–∞—Ä–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ —Å–æ –º–∏–ª–∏—Å–µ–∫—É–Ω–¥–Ω–∞ –ø—Ä–µ—Ü–∏–∑–Ω–æ—Å—Ç. –°–ª–µ–¥–µ—ö–µ –Ω–∞ –ù–ê–í –Ω–∞ —Ñ–æ–Ω–¥–æ–≤–∏—Ç–µ, –¥–≤–∏–∂–µ—ö–∞ –Ω–∞ –ø–∞–∑–∞—Ä–æ—Ç –∏ –ø—Ä–æ–º–µ–Ω–∏ –≤–æ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ—Ç–æ.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üîî</div>
        <h3>–ü–∞–º–µ—Ç–µ–Ω –°–∏—Å—Ç–µ–º –∑–∞ –ò–∑–≤–µ—Å—Ç—É–≤–∞—ö–∞</h3>
        <p>–ò–∑–≤–µ—Å—Ç—É–≤–∞—ö–∞ –∑–∞—Å–Ω–æ–≤–∞–Ω–∏ –Ω–∞ –≤–µ—à—Ç–∞—á–∫–∞ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ü–∏—ò–∞ –≤—Ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∏ –Ω–∞ –≤–æ–ª–∞—Ç–∏–ª–Ω–æ—Å—Ç, –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–∞ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞ —Ä–∏–∑–∏–∫.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üéØ</div>
        <h3>–ü—Ä–µ–¥–≤–∏–¥—É–≤–∞—ö–µ –Ω–∞ –¢—Ä–µ–Ω–¥–æ–≤–∏</h3>
        <p>–ê–ª–≥–æ—Ä–∏—Ç–º–∏ –∑–∞ –º–∞—à–∏–Ω—Å–∫–æ —É—á–µ—ö–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–∞—Ç –ø–∞–∑–∞—Ä–Ω–∏ –æ–±—Ä–∞—Å—Ü–∏ –∑–∞ –¥–∞ –ø—Ä–µ–¥–≤–∏–¥–∞—Ç –ø–æ—Ç–µ–Ω—Ü–∏—ò–∞–ª–Ω–∏ –∏—Å—Ö–æ–¥–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–∞—Ç –æ–ø—Ç–∏–º–∞–ª–Ω–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">‚öñÔ∏è</div>
        <h3>–ü—Ä–æ—Ü–µ–Ω–∞ –Ω–∞ –†–∏–∑–∏–∫</h3>
        <p>–°–µ–æ–ø—Ñ–∞—Ç–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ —Ä–∏–∑–∏–∫–æ—Ç –≤–∫–ª—É—á—É–≤–∞—ò—ú–∏ VaR, —Å—Ç—Ä–µ—Å —Ç–µ—Å—Ç–∏—Ä–∞—ö–µ, –∫–æ—Ä–µ–ª–∞—Ü–∏–æ–Ω–∏ –º–∞—Ç—Ä–∏—Ü–∏ –∏ –º–æ–¥–µ–ª–∏—Ä–∞—ö–µ –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏—ò–∞.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üìà</div>
        <h3>–°–ø–æ—Ä–µ–¥–±–∞ —Å–æ –ë–µ–Ω—á–º–∞—Ä–∫</h3>
        <p>–°–ø–æ—Ä–µ–¥–µ—Ç–µ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏ –ø—Ä–æ—Ç–∏–≤ –≥–ª–∞–≤–Ω–∏ –∏–Ω–¥–µ–∫—Å–∏, —Å–ª–∏—á–Ω–∏ —Ñ–æ–Ω–¥–æ–≤–∏ –∏ –ø—Ä–∏—Å–ø–æ—Å–æ–±–µ–Ω–∏ –±–µ–Ω—á–º–∞—Ä–∫–æ–≤–∏ —Å–æ –¥–µ—Ç–∞–ª–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">üìã</div>
        <h3>–†–µ–≥—É–ª–∞—Ç–æ—Ä–Ω–∏ –ò–∑–≤–µ—à—Ç–∞–∏</h3>
        <p>–ê–≤—Ç–æ–º–∞—Ç—Å–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—ò–∞ –Ω–∞ —Ä–µ–≥—É–ª–∞—Ç–æ—Ä–Ω–∏ –∏–∑–≤–µ—à—Ç–∞–∏, –¥–∞–Ω–æ—á–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∏ –¥–µ—Ç–∞–ª–Ω–∏ –∏–∑—ò–∞–≤–∏ –∑–∞ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏.</p>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div style="max-width: 800px; margin: 0 auto; text-align: left;">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
        <div>
          <h4 style="color: var(--accent-green); margin-bottom: 1rem;">–ó–∞ –ü—Ä–æ–µ–∫—Ç–æ—Ç</h4>
          <p style="color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">
            –§–æ–Ω–¥–ê–ª–∞—Ä–º –µ –Ω–µ–∑–∞–≤–∏—Å–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–∞ —Å–ª–µ–¥–µ—ö–µ –Ω–∞ –º–∞–∫–µ–¥–æ–Ω—Å–∫–∏—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ —Ñ–æ–Ω–¥–æ–≤–∏. 
            –ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–µ –∑–µ–º–∞–∞—Ç –æ–¥ —ò–∞–≤–Ω–æ –¥–æ—Å—Ç–∞–ø–Ω–∏ –∏–∑–≤–æ—Ä–∏ –∏ —Å–µ –∫–æ—Ä–∏—Å—Ç–∞—Ç –∑–∞ –µ–¥—É–∫–∞—Ü–∏—Å–∫–∏ —Ü–µ–ª–∏.
          </p>
        </div>
        <div>
          <h4 style="color: var(--accent-blue); margin-bottom: 1rem;">–ü—Ä–∞–≤–Ω–∏ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</h4>
          <p style="color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">
            –û–≤–∞–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ –¥–∞–≤–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ —Å–æ–≤–µ—Ç–∏. –°–µ–∫–æ–≥–∞—à –∫–æ–Ω—Å—É–ª—Ç–∏—Ä–∞—ò—Ç–µ —Å–µ —Å–æ 
            –ª–∏—Ü–µ–Ω—Ü–∏—Ä–∞–Ω —Ñ–∏–Ω–∞–Ω—Å–∏—Å–∫–∏ —Å–æ–≤–µ—Ç–Ω–∏–∫ –ø—Ä–µ–¥ –¥–æ–Ω–µ—Å—É–≤–∞—ö–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—Å–∫–∏ –æ–¥–ª—É–∫–∏.
          </p>
        </div>
        <div>
          <h4 style="color: var(--accent-gold); margin-bottom: 1rem;">–ö–æ–Ω—Ç–∞–∫—Ç</h4>
          <p style="color: var(--text-muted); font-size: 0.9rem;">
            –ó–∞ –ø—Ä–∞—à–∞—ö–∞ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∑–∏:<br/>
            <a href="mailto:fund-alarm@candelabra.mk" style="color: var(--accent-green);">fund-alarm@candelabra.mk</a>
          </p>
        </div>
      </div>
      <div style="text-align: center; padding-top: 2rem; border-top: 1px solid var(--border-color);">
        <p style="color: var(--text-muted);">&copy; 2025 Candelabra. –°–∏—Ç–µ –ø—Ä–∞–≤–∞ –∑–∞–¥—Ä–∂–∞–Ω–∏.</p>
      </div>
    </div>
  </footer>

  <script type="module">
    // Background animation - same as main page
    (function() {
      const canvas = document.getElementById('bgCanvas');
      if (!canvas) {
        console.warn('Background canvas not found, skipping animation');
        return;
      }
      
      const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const nodes = Array.from({ length: 60 }).map(() => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 0.8,
      vy: (Math.random() - 0.5) * 0.8
    }));

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#ffffff88';

      nodes.forEach(node => {
        ctx.beginPath();
        ctx.arc(node.x, node.y, 2.2, 0, Math.PI * 2);
        ctx.fill();
      });

      for (let i = 0; i < nodes.length; i++) {
        for (let j = i + 1; j < nodes.length; j++) {
          const a = nodes[i];
          const b = nodes[j];
          const dist = Math.hypot(a.x - b.x, a.y - b.y);
          if (dist < 120) {
            ctx.strokeStyle = '#ffffff44';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(a.x, a.y);
            ctx.lineTo(b.x, b.y);
            ctx.stroke();
          }
        }
      }

      nodes.forEach(n => {
        n.x += n.vx;
        n.y += n.vy;

        if (n.x < 0 || n.x > canvas.width) n.vx *= -1;
        if (n.y < 0 || n.y > canvas.height) n.vy *= -1;
      });

      requestAnimationFrame(draw);
    }

    draw();

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    // CSV Data Loading Functions
    async function loadCSVFile(csvPath) {
      try {
        const response = await fetch(csvPath);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const csvText = await response.text();
        return parseCSV(csvText);
      } catch (error) {
        console.error('Error loading CSV file:', error);
        return null;
      }
    }

    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      if (lines.length === 0) return null;
      
      // Parse CSV with proper handling of quotes and commas
      function parseCSVLine(line) {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current.trim());
        return result;
      }
      
      const headers = parseCSVLine(lines[0]);
      const data = [];
      
      for (let i = 1; i < lines.length; i++) {
        if (lines[i].trim()) { // Skip empty lines
          const values = parseCSVLine(lines[i]);
          const row = {};
          headers.forEach((header, index) => {
            row[header] = values[index] || '';
          });
          data.push(row);
        }
      }
      
      return { headers, data };
    }

    // Global variables for dashboard state
    let currentTimePeriod = '1M';
    let allFundData = {};
    let visibleFunds = {};

    // Fund type dashboard functions


    function organizeFundData(csvData) {
      const fundData = {
        equity: {},
        bond: {},
        balanced: {},
        money: {},
        sectoral: {},
        index: {}
      };

      if (!csvData || !csvData.data) {
        console.warn('No CSV data available for organization');
        return fundData;
      }

      // List of active funds to include
      const activeFunds = [
        '–ò–Ω–æ–≤–æ –°—Ç–∞—Ç—É—Å –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω',
        '–ù–õ–ë –ë–†–ò–ö',
        '–ù–õ–ë –ê–º–µ—Ä–∏–∫–∞',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –û–±–≤—Ä–∑–Ω–∏—Ü–∏',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç –ü–∞—Ä–∏—á–µ–Ω',
        '–ù–õ–ë –ö–µ—à –î–µ–ø–æ–∑–∏—Ç',
        '–ù–õ–ë –¢–æ–ø –ë—Ä–µ–Ω–¥–æ–≤–∏',
        '–í–§–ü –ü—Ä–µ–º–∏—É–º –ê–∫—Ü–∏–∏',
        '–í–§–ü –ö–µ—à –î–µ–ø–æ–∑–∏—Ç',
        '–í–§–ü –ë–û–ù–î',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ú–ë–ò 10',
        '–ì—Ä–∞–≤–µ –ì–ª–æ–±–∞–ª',
        '–í–§–ü –î–∏–≤–∏–¥–µ–Ω–¥–∞ –ê–∫—Ü–∏–∏',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ê–∫—Ü–∏–∏',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ó–ª–∞—Ç–µ–Ω —Ñ–æ–Ω–¥',
        '–í–ï–ì–ê –°–í–ï–¢',
        '–í–ï–ì–ê –§–ò–ù–ê–ù–°–ò–ò',
        '–í–ï–ì–ê –¢–ï–•–ù–û–õ–û–ì–ò–à–ê',
        '–í–ï–ì–ê –ö–ï–®',
        '–ò–Ω–æ–≤–æ –°—Ç–∞—Ç—É—Å –°–æ–ª–∞—Ä',
        '–ì—Ä–∞–≤–µ –§–ª–µ–∫—Å –ë–æ–Ω–¥ –ï–≤—Ä–æ',
        '–í–§–ü –ï—Ç–∏–∫—Å –ê–∫—Ü–∏–∏',
        '–ù–õ–ë –û–±–≤—Ä–∑–Ω–∏—Ü–∏'
      ];

      console.log('Organizing data from', csvData.data.length, 'rows');
      console.log('Filtering for', activeFunds.length, 'active funds');
      let processedRows = 0;

      csvData.data.forEach(row => {
        const fundName = row['–ù–∞–∑–∏–≤ –Ω–∞ –æ—Ç–≤–æ—Ä–µ–Ω–∏–æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–µ–Ω —Ñ–æ–Ω–¥'];
        const valuationDate = row['–î–∞—Ç—É–º –Ω–∞ –≤—Ä–µ–¥–Ω—É–≤–∞—ö–µ'];
        const calculationDate = row['–î–∞—Ç—É–º –Ω–∞ –ø—Ä–µ—Å–º–µ—Ç–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ—Ç –∑–∞ —É–¥–µ–ª'];
        const date = valuationDate || calculationDate;
        const value = parseFloat(row['–î–Ω–µ–≤–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∞ –ø—Ä–æ–¥–∞–∂–Ω–∞ —Ü–µ–Ω–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ—Ç –∑–∞ —É–¥–µ–ª'] || 0);
        
        // Only process funds that are in our active funds list
        if (!fundName || !activeFunds.includes(fundName) || !date || !value || value <= 0) return;

        // Determine fund type based on specific fund name or characteristics
        let fundType = 'equity'; // default to equity
        const lowerName = fundName.toLowerCase();
        
        // Define specific fund categorizations
        const sectoralFunds = [
          '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ó–ª–∞—Ç–µ–Ω —Ñ–æ–Ω–¥',
          '–í–ï–ì–ê –§–ò–ù–ê–ù–°–ò–ò',
          '–í–ï–ì–ê –¢–ï–•–ù–û–õ–û–ì–ò–à–ê',
          '–ò–Ω–æ–≤–æ –°—Ç–∞—Ç—É—Å –°–æ–ª–∞—Ä',
          '–í–§–ü –ï—Ç–∏–∫—Å –ê–∫—Ü–∏–∏'
        ];
        
        const indexFunds = [
          '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ú–ë–ò 10'
        ];
        
        // Check specific fund categories first
        if (sectoralFunds.includes(fundName)) {
          fundType = 'sectoral';
        } else if (indexFunds.includes(fundName)) {
          fundType = 'index';
        } else if (lowerName.includes('–∫–µ—à') || lowerName.includes('–ø–∞—Ä–∏—á–µ–Ω') || lowerName.includes('–¥–µ–ø–æ–∑–∏—Ç') || lowerName.includes('cash') || lowerName.includes('money')) {
          fundType = 'money';
        } else if (lowerName.includes('–±–æ–Ω–¥') || lowerName.includes('–æ–±–≤—Ä–∑–Ω–∏—Ü–∏') || lowerName.includes('bond') || lowerName.includes('–æ–±–ª–∏–≥–∞—Ü–∏–∏')) {
          fundType = 'bond';
        } else if (lowerName.includes('–±–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω') || lowerName.includes('—Ñ–ª–µ–∫—Å') || lowerName.includes('balanced') || lowerName.includes('–º–∏–∫—Å')) {
          fundType = 'balanced';
        }

        if (!fundData[fundType][fundName]) {
          fundData[fundType][fundName] = [];
        }

        // Parse date properly - handle DD.MM.YYYY format
        let timestamp;
        try {
          const dateParts = date.split('.');
          if (dateParts.length === 3) {
            // DD.MM.YYYY format
            const day = parseInt(dateParts[0]);
            const month = parseInt(dateParts[1]) - 1; // Month is 0-indexed
            const year = parseInt(dateParts[2]);
            timestamp = new Date(year, month, day).getTime();
          } else {
            timestamp = new Date(date).getTime();
          }
        } catch (e) {
          console.warn('Error parsing date:', date);
          return;
        }

        if (isNaN(timestamp)) return;

        fundData[fundType][fundName].push({
          date: date,
          value: value,
          timestamp: timestamp
        });

        processedRows++;
      });

      console.log('Processed', processedRows, 'valid rows');

      // Sort data points by date for each fund and remove duplicates
      const now = new Date();
      const thirtyDaysAgo = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000)); // 30 days ago
      
      Object.keys(fundData).forEach(fundType => {
        const activeFunds = {};
        
        Object.keys(fundData[fundType]).forEach(fundName => {
          // Sort by timestamp
          fundData[fundType][fundName].sort((a, b) => a.timestamp - b.timestamp);
          
          // Remove duplicate dates, keeping the latest value for each date
          const dateMap = new Map();
          
          fundData[fundType][fundName].forEach(item => {
            const dateKey = item.date;
            if (!dateMap.has(dateKey) || item.timestamp > dateMap.get(dateKey).timestamp) {
              dateMap.set(dateKey, item);
            }
          });
          
          const uniqueData = Array.from(dateMap.values()).sort((a, b) => a.timestamp - b.timestamp);
          
          // Check if fund has recent data (within last 30 days)
          const latestDataPoint = uniqueData[uniqueData.length - 1];
          if (latestDataPoint && latestDataPoint.timestamp >= thirtyDaysAgo.getTime()) {
            activeFunds[fundName] = uniqueData;
          }
        });
        
        // Replace with only active funds
        fundData[fundType] = activeFunds;
      });

      // Log summary of organized data
      console.log('Organized ACTIVE fund data summary (funds with data in last 30 days):');
      let totalActiveFunds = 0;
      Object.keys(fundData).forEach(fundType => {
        const fundCount = Object.keys(fundData[fundType]).length;
        totalActiveFunds += fundCount;
        console.log(`${fundType}: ${fundCount} active funds`);
        if (fundCount > 0) {
          Object.keys(fundData[fundType]).slice(0, 3).forEach(fundName => {
            const dataPoints = fundData[fundType][fundName].length;
            const latestDate = fundData[fundType][fundName][dataPoints - 1].date;
            console.log(`  - ${fundName}: ${dataPoints} data points (latest: ${latestDate})`);
          });
          if (fundCount > 3) {
            console.log(`  ... and ${fundCount - 3} more active funds`);
          }
        }
      });
      console.log(`Total active funds: ${totalActiveFunds}`);

      return fundData;
    }

    // Placeholder function to maintain compatibility
    function createPortfolioChart(csvData) {
      if (!csvData || !csvData.data.length) {
        showPlaceholder('portfolio-chart', '–ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ—Ç–æ');
        return;
      }

      const trace = {
        x: csvData.data.map(row => row.date || row.Date),
        y: csvData.data.map(row => parseFloat(row.value || row.Value || 0)),
        type: 'scatter',
        mode: 'lines+markers',
        line: { color: '#00d4aa', width: 3 },
        marker: { color: '#4a9eff', size: 6 },
        fill: 'tonexty',
        fillcolor: 'rgba(0, 212, 170, 0.1)'
      };

      const layout = {
        title: {
          text: 'Portfolio Value Over Time',
          font: { color: '#f7b801', size: 16 }
        },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(42, 54, 85, 0.3)',
        font: { color: '#b8c5d6' },
        xaxis: { 
          gridcolor: '#334566',
          tickfont: { color: '#8a9bb5' },
          showgrid: true
        },
        yaxis: { 
          gridcolor: '#334566',
          tickfont: { color: '#8a9bb5' },
          showgrid: true,
          tickformat: '$,.0f'
        },
        margin: { t: 40, r: 20, b: 40, l: 60 }
      };

      Plotly.newPlot('portfolio-chart', [trace], layout, { responsive: true, displayModeBar: false });
    }

    function createAllocationChart(csvData) {
      if (!csvData || !csvData.data.length) {
        showPlaceholder('allocation-chart', '–ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞');
        return;
      }

      const trace = {
        values: csvData.data.map(row => parseFloat(row.allocation || row.Allocation || 0)),
        labels: csvData.data.map(row => row.fund_name || row.Fund || row.Name),
        type: 'pie',
        marker: {
          colors: ['#00d4aa', '#4a9eff', '#f7b801', '#8b5cf6', '#ff5757', '#10b981']
        },
        textfont: { color: '#ffffff', size: 12 },
        hovertemplate: '<b>%{label}</b><br>Allocation: %{value}%<br>Value: $%{customdata}<extra></extra>',
        hole: 0.4
      };

      const layout = {
        title: {
          text: 'Asset Allocation Breakdown',
          font: { color: '#f7b801', size: 16 }
        },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#b8c5d6' },
        showlegend: true,
        legend: {
          orientation: 'v',
          x: 1.02,
          y: 0.5,
          font: { color: '#b8c5d6' }
        },
        margin: { t: 40, r: 120, b: 40, l: 40 }
      };

      Plotly.newPlot('allocation-chart', [trace], layout, { responsive: true, displayModeBar: false });
    }

    function createTrendsChart(csvData) {
      if (!csvData || !csvData.data.length) {
        showPlaceholder('trends-chart', '–ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤–∏');
        return;
      }

      const fundNames = [...new Set(csvData.data.map(row => row.fund_name || row.Fund))];
      const colors = ['#00d4aa', '#4a9eff', '#f7b801', '#8b5cf6', '#ff5757'];
      
      const traces = fundNames.map((fund, index) => {
        const fundData = csvData.data.filter(row => (row.fund_name || row.Fund) === fund);
        return {
          x: fundData.map(row => row.date || row.Date),
          y: fundData.map(row => parseFloat(row.performance || row.Performance || 0)),
          type: 'scatter',
          mode: 'lines+markers',
          name: fund,
          line: { 
            color: colors[index % colors.length],
            width: 2
          },
          marker: { size: 4 }
        };
      });

      const layout = {
        title: {
          text: 'Fund Performance Comparison',
          font: { color: '#f7b801', size: 16 }
        },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(42, 54, 85, 0.3)',
        font: { color: '#b8c5d6' },
        xaxis: { 
          gridcolor: '#334566',
          tickfont: { color: '#8a9bb5' }
        },
        yaxis: { 
          gridcolor: '#334566',
          tickfont: { color: '#8a9bb5' },
          tickformat: '+.1%'
        },
        legend: { 
          font: { color: '#b8c5d6' },
          bgcolor: 'rgba(30, 38, 66, 0.8)'
        },
        margin: { t: 40, r: 20, b: 40, l: 60 }
      };

      Plotly.newPlot('trends-chart', traces, layout, { responsive: true, displayModeBar: false });
    }

    function createRiskChart(csvData) {
      if (!csvData || !csvData.data.length) {
        showPlaceholder('risk-chart', '–ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ —Ä–∏–∑–∏–∫');
        return;
      }

      const trace = {
        x: csvData.data.map(row => row.fund_name || row.Fund),
        y: csvData.data.map(row => parseFloat(row.risk_score || row.Risk || 0)),
        type: 'bar',
        marker: {
          color: csvData.data.map(row => {
            const risk = parseFloat(row.risk_score || row.Risk || 0);
            if (risk < 3) return '#10b981'; // Low risk - green
            if (risk < 5) return '#f7b801'; // Medium risk - yellow
            return '#ff5757'; // High risk - red
          }),
          opacity: 0.8
        },
        text: csvData.data.map(row => `Risk: ${row.risk_score || row.Risk || 0}`),
        textposition: 'auto'
      };

      const layout = {
        title: {
          text: 'Risk Assessment by Fund',
          font: { color: '#f7b801', size: 16 }
        },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(42, 54, 85, 0.3)',
        font: { color: '#b8c5d6' },
        xaxis: { 
          gridcolor: '#334566',
          tickfont: { color: '#8a9bb5' }
        },
        yaxis: { 
          gridcolor: '#334566',
          tickfont: { color: '#8a9bb5' },
          title: 'Risk Score'
        },
        margin: { t: 40, r: 20, b: 80, l: 60 }
      };

      Plotly.newPlot('risk-chart', [trace], layout, { responsive: true, displayModeBar: false });
    }

    function createEquityChart() {
      createFundChart('equity', 'üìà –ê–∫—Ü–∏—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏', '#equity-chart', '#equity-legend');
    }

    function createBondChart() {
      createFundChart('bond', 'üèõÔ∏è –û–±–≤—Ä–∑–Ω–∏—á–∫–∏ –§–æ–Ω–¥–æ–≤–∏', '#bond-chart', '#bond-legend');
    }

    function createBalancedChart() {
      createFundChart('balanced', '‚öñÔ∏è –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω–∏ –§–æ–Ω–¥–æ–≤–∏', '#balanced-chart', '#balanced-legend');
    }

    function createMoneyChart() {
      createFundChart('money', 'üí∞ –ü–∞—Ä–∏—á–Ω–∏ –§–æ–Ω–¥–æ–≤–∏', '#money-chart', '#money-legend');
    }

    function createSectoralChart() {
      createFundChart('sectoral', 'üè≠ –°–µ–∫—Ç–æ—Ä—Å–∫–∏ –§–æ–Ω–¥–æ–≤–∏', '#sectoral-chart', '#sectoral-legend');
    }

    function createIndexChart() {
      createFundChart('index', 'üìä –ò–Ω–¥–µ–∫—Å–Ω–∏ –§–æ–Ω–¥–æ–≤–∏', '#index-chart', '#index-legend');
    }

    function createFundChart(fundType, title, chartId, legendId) {
      const funds = allFundData[fundType] || {};
      const fundNames = Object.keys(funds);
      
      if (fundNames.length === 0) {
        document.querySelector(chartId).innerHTML = `
          <div style="padding: 2rem; text-align: center; color: var(--text-muted);">
            –ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ ${title.toLowerCase()}
          </div>
        `;
        return;
      }

      const colors = generateColors(fundNames.length);
      const traces = [];

      fundNames.forEach((fundName, index) => {
        const fundData = funds[fundName];
        const filteredData = filterDataByPeriod(fundData, currentTimePeriod);
        
        traces.push({
          x: filteredData.map(d => d.date),
          y: filteredData.map(d => d.value),
          type: 'scatter',
          mode: 'lines',
          name: fundName,
          line: { 
            color: colors[index], 
            width: 2 
          },
          visible: visibleFunds[fundType][fundName] ? true : 'legendonly'
        });
      });

      const layout = {
        title: {
          text: `${title} - –í—Ä–µ–¥–Ω–æ—Å—Ç–∏ –≤–æ –≤—Ä–µ–º–µ—Ç–æ`,
          font: { color: '#f7b801', size: 16 }
        },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(30, 41, 59, 0.4)',
        font: { color: '#b8c5d6' },
        xaxis: { 
          title: '–î–∞—Ç—É–º',
          gridcolor: 'rgba(51, 69, 102, 0.3)',
          linecolor: 'rgba(51, 69, 102, 0.5)',
          tickangle: -45
        },
        yaxis: { 
          title: '–í—Ä–µ–¥–Ω–æ—Å—Ç (–¥–µ–Ω)',
          gridcolor: 'rgba(51, 69, 102, 0.3)',
          linecolor: 'rgba(51, 69, 102, 0.5)'
        },
        legend: {
          font: { color: '#b8c5d6', size: 10 },
          orientation: 'h',
          y: -0.2
        },
        margin: {
          l: 60,
          r: 30,
          t: 60,
          b: 100
        }
      };

      Plotly.newPlot(chartId.substring(1), traces, layout, { 
        responsive: true, 
        displayModeBar: false 
      });

      // Create legend for fund toggles
      createFundLegend(fundType, fundNames, colors, legendId);
    }

    function generateColors(count) {
      const baseColors = [
        '#00d4aa', '#4a9eff', '#8b5cf6', '#f7b801', '#ff5757',
        '#10b981', '#3b82f6', '#8b5cf6', '#f59e0b', '#ef4444',
        '#06b6d4', '#6366f1', '#84cc16', '#f97316', '#ec4899'
      ];
      
      const colors = [];
      for (let i = 0; i < count; i++) {
        colors.push(baseColors[i % baseColors.length]);
      }
      return colors;
    }

    function createFundLegend(fundType, fundNames, colors, legendId) {
      const legendContainer = document.querySelector(legendId);
      if (!legendContainer) return;

      legendContainer.innerHTML = fundNames.map((fundName, index) => `
        <div class="legend-item" data-fund-type="${fundType}" data-fund-name="${fundName}">
          <div class="legend-color" style="background-color: ${colors[index]}"></div>
          <span>${fundName}</span>
        </div>
      `).join('');
    }

    function filterDataByPeriod(data, period) {
      if (!data || data.length === 0) return [];
      
      const now = new Date();
      let cutoffDate;
      
      switch (period) {
        case '1M':
          cutoffDate = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
          break;
        case '3M':
          cutoffDate = new Date(now.getFullYear(), now.getMonth() - 3, now.getDate());
          break;
        case '6M':
          cutoffDate = new Date(now.getFullYear(), now.getMonth() - 6, now.getDate());
          break;
        case '1Y':
          cutoffDate = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
          break;
        case 'ALL':
        default:
          return data;
      }
      
      return data.filter(d => d.timestamp >= cutoffDate.getTime());
    }

    function setupTimeFilterListeners() {
      document.querySelectorAll('.time-filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          // Update active state
          document.querySelectorAll('.time-filter-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // Update current period and refresh charts
          currentTimePeriod = this.dataset.period;
          refreshAllCharts();
        });
      });
    }

    function setupFundToggleListeners() {
      // Toggle individual funds
      document.addEventListener('click', function(e) {
        if (e.target.closest('.legend-item')) {
          const item = e.target.closest('.legend-item');
          const fundType = item.dataset.fundType;
          const fundName = item.dataset.fundName;
          
          visibleFunds[fundType][fundName] = !visibleFunds[fundType][fundName];
          item.classList.toggle('hidden');
          
          refreshChart(fundType);
        }
      });

      // Toggle all funds for a type
      document.querySelectorAll('.toggle-all-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const fundType = this.dataset.type;
          const allVisible = Object.values(visibleFunds[fundType] || {}).every(v => v);
          
          Object.keys(visibleFunds[fundType] || {}).forEach(fundName => {
            visibleFunds[fundType][fundName] = !allVisible;
          });
          
          // Update legend visual state
          document.querySelectorAll(`[data-fund-type="${fundType}"]`).forEach(item => {
            if (allVisible) {
              item.classList.add('hidden');
            } else {
              item.classList.remove('hidden');
            }
          });
          
          refreshChart(fundType);
        });
      });
    }

    function refreshAllCharts() {
      createEquityChart();
      createBondChart();
      createBalancedChart();
      createMoneyChart();
      createSectoralChart();
      createIndexChart();
    }

    function refreshChart(fundType) {
      switch (fundType) {
        case 'equity':
          createEquityChart();
          break;
        case 'bond':
          createBondChart();
          break;
        case 'balanced':
          createBalancedChart();
          break;
        case 'money':
          createMoneyChart();
          break;
        case 'sectoral':
          createSectoralChart();
          break;
        case 'index':
          createIndexChart();
          break;
      }
    }

    function populateFundsTable(csvData) {
      console.log('populateFundsTable called with:', csvData);
      
      const tableBody = document.getElementById('funds-table-body');
      if (!tableBody) {
        console.error('Table body element not found');
        return;
      }

      if (!csvData || !csvData.data || !csvData.data.length) {
        console.warn('No CSV data available for table');
        tableBody.innerHTML = `
          <tr>
            <td colspan="8" style="padding: 2rem; text-align: center; color: var(--text-muted);">
              –ù–µ–º–∞ –¥–æ—Å—Ç–∞–ø–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ —Ñ–æ–Ω–¥–æ–≤–∏—Ç–µ
            </td>
          </tr>
        `;
        return;
      }

      // List of active funds to include (same as in organizeFundData)
      const activeFunds = [
        '–ò–Ω–æ–≤–æ –°—Ç–∞—Ç—É—Å –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω',
        '–ù–õ–ë –ë–†–ò–ö',
        '–ù–õ–ë –ê–º–µ—Ä–∏–∫–∞',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –û–±–≤—Ä–∑–Ω–∏—Ü–∏',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç –ü–∞—Ä–∏—á–µ–Ω',
        '–ù–õ–ë –ö–µ—à –î–µ–ø–æ–∑–∏—Ç',
        '–ù–õ–ë –¢–æ–ø –ë—Ä–µ–Ω–¥–æ–≤–∏',
        '–í–§–ü –ü—Ä–µ–º–∏—É–º –ê–∫—Ü–∏–∏',
        '–í–§–ü –ö–µ—à –î–µ–ø–æ–∑–∏—Ç',
        '–í–§–ü –ë–û–ù–î',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ú–ë–ò 10',
        '–ì—Ä–∞–≤–µ –ì–ª–æ–±–∞–ª',
        '–í–§–ü –î–∏–≤–∏–¥–µ–Ω–¥–∞ –ê–∫—Ü–∏–∏',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ê–∫—Ü–∏–∏',
        '–ö–ë –ò–Ω–≤–µ—Å—Ç - –ó–ª–∞—Ç–µ–Ω —Ñ–æ–Ω–¥',
        '–í–ï–ì–ê –°–í–ï–¢',
        '–í–ï–ì–ê –§–ò–ù–ê–ù–°–ò–ò',
        '–í–ï–ì–ê –¢–ï–•–ù–û–õ–û–ì–ò–à–ê',
        '–í–ï–ì–ê –ö–ï–®',
        '–ò–Ω–æ–≤–æ –°—Ç–∞—Ç—É—Å –°–æ–ª–∞—Ä',
        '–ì—Ä–∞–≤–µ –§–ª–µ–∫—Å –ë–æ–Ω–¥ –ï–≤—Ä–æ',
        '–í–§–ü –ï—Ç–∏–∫—Å –ê–∫—Ü–∏–∏',
        '–ù–õ–ë –û–±–≤—Ä–∑–Ω–∏—Ü–∏'
      ];

      console.log('Processing', csvData.data.length, 'rows of CSV data');
      console.log('Filtering for', activeFunds.length, 'active funds');
      console.log('Sample row:', csvData.data[0]);

      // Clear existing data
      tableBody.innerHTML = '';

      // Get unique funds (latest data for each fund)
      const fundMap = new Map();
      let processedCount = 0;
      
      csvData.data.forEach((row, index) => {
        const fundName = row['–ù–∞–∑–∏–≤ –Ω–∞ –æ—Ç–≤–æ—Ä–µ–Ω–∏–æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–µ–Ω —Ñ–æ–Ω–¥'];
        const calculationDate = row['–î–∞—Ç—É–º –Ω–∞ –ø—Ä–µ—Å–º–µ—Ç–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ—Ç –∑–∞ —É–¥–µ–ª'];
        const valuationDate = row['–î–∞—Ç—É–º –Ω–∞ –≤—Ä–µ–¥–Ω—É–≤–∞—ö–µ'];
        
        // Only process funds that are in our active funds list
        if (fundName && fundName.trim() && activeFunds.includes(fundName)) {
          processedCount++;
          
          const dateString = valuationDate || calculationDate || '';
          if (!dateString) return;
          
          // Convert DD.MM.YYYY to timestamp for proper comparison
          let timestamp = 0;
          try {
            const dateParts = dateString.split('.');
            if (dateParts.length === 3) {
              const day = parseInt(dateParts[0]);
              const month = parseInt(dateParts[1]) - 1; // Month is 0-indexed
              const year = parseInt(dateParts[2]);
              timestamp = new Date(year, month, day).getTime();
            }
          } catch (e) {
            console.warn('Error parsing date:', dateString);
            return;
          }
          
          if (isNaN(timestamp) || timestamp <= 0) return;
          
          const currentEntry = fundMap.get(fundName);
          
          // Keep the entry with the latest timestamp
          if (!currentEntry || timestamp > (currentEntry.timestamp || 0)) {
            fundMap.set(fundName, { ...row, dateKey: dateString, timestamp });
          }
        }
      });

      console.log('Processed', processedCount, 'valid rows, found', fundMap.size, 'unique funds');

      // Sort funds alphabetically
      const sortedFunds = Array.from(fundMap.values()).sort((a, b) => {
        const nameA = a['–ù–∞–∑–∏–≤ –Ω–∞ –æ—Ç–≤–æ—Ä–µ–Ω–∏–æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–µ–Ω —Ñ–æ–Ω–¥'] || '';
        const nameB = b['–ù–∞–∑–∏–≤ –Ω–∞ –æ—Ç–≤–æ—Ä–µ–Ω–∏–æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–µ–Ω —Ñ–æ–Ω–¥'] || '';
        return nameA.localeCompare(nameB, 'mk');
      });

      console.log('Creating table rows for', sortedFunds.length, 'funds');

      // Create table rows for ALL unique funds
      sortedFunds.forEach((row, index) => {
        try {
          const fundName = row['–ù–∞–∑–∏–≤ –Ω–∞ –æ—Ç–≤–æ—Ä–µ–Ω–∏–æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–µ–Ω —Ñ–æ–Ω–¥'] || '–ù–µ–ø–æ–∑–Ω–∞—Ç –§–æ–Ω–¥';
          const nav = parseFloat(row['–î–Ω–µ–≤–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∞ –ø—Ä–æ–¥–∞–∂–Ω–∞ —Ü–µ–Ω–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ—Ç –∑–∞ —É–¥–µ–ª'] || 100);
          const valuationDate = row['–î–∞—Ç—É–º –Ω–∞ –≤—Ä–µ–¥–Ω—É–≤–∞—ö–µ'] || row['–î–∞—Ç—É–º –Ω–∞ –ø—Ä–µ—Å–º–µ—Ç–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ—Ç –∑–∞ —É–¥–µ–ª'] || '18.10.2025';
          
          // Determine fund type based on name
          let fundType = '–ê–∫—Ü–∏—Å–∫–∏';
          const lowerName = fundName.toLowerCase();
          if (lowerName.includes('–∫–µ—à') || lowerName.includes('–ø–∞—Ä–∏—á–µ–Ω') || lowerName.includes('–¥–µ–ø–æ–∑–∏—Ç')) {
            fundType = '–ü–∞—Ä–∏—á–µ–Ω';
          } else if (lowerName.includes('–±–æ–Ω–¥') || lowerName.includes('–æ–±–≤—Ä–∑–Ω–∏—Ü–∏')) {
            fundType = '–û–±–≤—Ä–∑–Ω–∏—Ü–∏';
          } else if (lowerName.includes('–±–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω') || lowerName.includes('—Ñ–ª–µ–∫—Å')) {
            fundType = '–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω';
          }
          
          // Calculate daily change (simplified for demo)
          const basePrice = 100;
          const change = nav - basePrice;
          const dailyPercent = ((nav - basePrice) / basePrice) * 100;
          const yearlyPercent = dailyPercent * 2; // Simplified yearly estimate
          
          // Determine risk level
          let riskLevel = '–£–º–µ—Ä–µ–Ω';
          if (fundType === '–ü–∞—Ä–∏—á–µ–Ω') {
            riskLevel = '–ù–∏–∑–æ–∫';
          } else if (fundType === '–û–±–≤—Ä–∑–Ω–∏—Ü–∏') {
            riskLevel = '–ù–∏–∑–æ–∫';
          } else if (fundType === '–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω') {
            riskLevel = '–£–º–µ—Ä–µ–Ω';
          } else {
            riskLevel = '–í–∏—Å–æ–∫';
          }

          // Determine colors based on values
          const changeColor = change >= 0 ? 'var(--success)' : 'var(--danger)';
          const dailyColor = dailyPercent >= 0 ? 'var(--success)' : 'var(--danger)';
          const yearlyColor = yearlyPercent >= 0 ? 'var(--success)' : 'var(--danger)';
          
          // Fund type styling
          const typeStyles = {
            '–ê–∫—Ü–∏—Å–∫–∏': { bg: 'rgba(0, 212, 170, 0.2)', color: 'var(--accent-green)' },
            '–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω': { bg: 'rgba(74, 158, 255, 0.2)', color: 'var(--accent-blue)' },
            '–û–±–≤—Ä–∑–Ω–∏—Ü–∏': { bg: 'rgba(139, 92, 246, 0.2)', color: 'var(--accent-purple)' },
            '–ü–∞—Ä–∏—á–µ–Ω': { bg: 'rgba(138, 155, 181, 0.2)', color: 'var(--text-muted)' }
          };
          const typeStyle = typeStyles[fundType] || typeStyles['–ê–∫—Ü–∏—Å–∫–∏'];

          // Risk level styling
          const riskStyles = {
            '–ù–∏–∑–æ–∫': { bg: 'rgba(16, 185, 129, 0.2)', color: 'var(--success)' },
            '–£–º–µ—Ä–µ–Ω': { bg: 'rgba(247, 184, 1, 0.2)', color: 'var(--accent-gold)' },
            '–í–∏—Å–æ–∫': { bg: 'rgba(255, 87, 87, 0.2)', color: 'var(--accent-red)' }
          };
          const riskStyle = riskStyles[riskLevel] || riskStyles['–£–º–µ—Ä–µ–Ω'];

          const row_html = `
            <tr style="border-bottom: 1px solid rgba(51, 69, 102, 0.3); transition: background-color 0.3s ease;" 
                onmouseover="this.style.backgroundColor='rgba(0, 212, 170, 0.05)'" 
                onmouseout="this.style.backgroundColor='transparent'">
              <td style="padding: 1rem; color: var(--text-primary); font-weight: 500;">${fundName}</td>
              <td style="padding: 1rem; color: var(--text-secondary);">
                <span style="background: ${typeStyle.bg}; color: ${typeStyle.color}; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.8rem;">${fundType}</span>
              </td>
              <td style="padding: 1rem; text-align: right; color: var(--text-primary); font-weight: 600;">${nav.toLocaleString('mk-MK', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
              <td style="padding: 1rem; text-align: right; color: ${changeColor};">${change >= 0 ? '+' : ''}${change.toFixed(2)}</td>
              <td style="padding: 1rem; text-align: right; color: ${dailyColor};">${dailyPercent >= 0 ? '+' : ''}${dailyPercent.toFixed(2)}%</td>
              <td style="padding: 1rem; text-align: right; color: ${yearlyColor};">${yearlyPercent >= 0 ? '+' : ''}${yearlyPercent.toFixed(1)}%</td>
              <td style="padding: 1rem; text-align: right;">
                <span style="background: ${riskStyle.bg}; color: ${riskStyle.color}; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.8rem;">${riskLevel}</span>
              </td>
              <td style="padding: 1rem; text-align: center; color: var(--text-muted); font-size: 0.9rem;">${valuationDate}</td>
            </tr>
          `;
          
          tableBody.innerHTML += row_html;
        } catch (error) {
          console.error('Error creating table row for fund:', row['–ù–∞–∑–∏–≤ –Ω–∞ –æ—Ç–≤–æ—Ä–µ–Ω–∏–æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–µ–Ω —Ñ–æ–Ω–¥'], error);
        }
      });

      console.log('Table population completed with', sortedFunds.length, 'funds');

      // Update stats
      const totalFunds = fundMap.size;
      const fundsCountElement = document.getElementById('funds-count');
      const lastUpdatedElement = document.getElementById('last-updated');
      
      if (fundsCountElement) {
        fundsCountElement.innerHTML = `üìä –í–∫—É–ø–Ω–æ ${totalFunds} –∞–∫—Ç–∏–≤–Ω–∏ —Ñ–æ–Ω–¥–æ–≤–∏`;
      }
      
      if (lastUpdatedElement) {
        const now = new Date();
        const dateStr = now.toLocaleDateString('mk-MK');
        const timeStr = now.toLocaleTimeString('mk-MK', { hour: '2-digit', minute: '2-digit' });
        lastUpdatedElement.innerHTML = `üïí –ü–æ—Å–ª–µ–¥–Ω–æ –∞–∂—É—Ä–∏—Ä–∞–Ω–æ: ${dateStr} ${timeStr}`;
      }
    }

    function showPlaceholder(elementId, message) {
      const element = document.getElementById(elementId);
      if (element) {
        element.innerHTML = `<div class="chart-placeholder">${message}</div>`;
      }
    }

    // Initialize charts when page loads
    async function initializeCharts() {
      try {
        // Load the CSV file from the data directory
        const csvData = await loadCSVFile('./data/data_all.csv');
        
        if (csvData) {
          console.log('CSV data loaded successfully:', csvData);
          console.log('Sample data rows:', csvData.data.slice(0, 3));
          populateFundsTable(csvData);
          
          // Organize data by fund types and create dashboard charts
          allFundData = organizeFundData(csvData);
          
          // Initialize visibility state for all funds
          visibleFunds = { equity: {}, bond: {}, balanced: {}, money: {}, sectoral: {}, index: {} };
          Object.keys(allFundData).forEach(fundType => {
            Object.keys(allFundData[fundType]).forEach(fundName => {
              visibleFunds[fundType][fundName] = true;
            });
          });
          
          setupTimeFilterListeners();
          setupFundToggleListeners();
          refreshAllCharts();
          
          // Create fund distribution charts
          createFundDistributionCharts();
          
          // Update notifications after fund data is loaded
          updateNotificationsAfterDataLoad();
        } else {
          console.warn('–ù–µ—É—Å–ø–µ—à–Ω–æ –≤—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ CSV –ø–æ–¥–∞—Ç–æ—Ü–∏, —Å–µ –ø—Ä–∏–∫–∞–∂—É–≤–∞–∞—Ç –∑–∞–º–µ–Ω—Å–∫–∏');
          showPlaceholder('portfolio-chart', '–ü–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ –∑–∞ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ—Ç–æ —ú–µ —Å–µ –ø–æ—ò–∞–≤–∞—Ç –æ–≤–¥–µ –∫–æ–≥–∞ —ú–µ —Å–µ –≤—á–∏—Ç–∞–∞—Ç CSV –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ');
          showPlaceholder('allocation-chart', '–†–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞—Ç–∞ –Ω–∞ —Ñ–æ–Ω–¥–æ–≤–∏—Ç–µ —ú–µ —Å–µ –ø–æ—ò–∞–≤–∏ –æ–≤–¥–µ –∫–æ–≥–∞ —ú–µ —Å–µ –≤—á–∏—Ç–∞–∞—Ç CSV –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ');
          showPlaceholder('trends-chart', '–¢—Ä–µ–Ω–¥–æ–≤–∏—Ç–µ –Ω–∞ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏—Ç–µ —ú–µ —Å–µ –ø–æ—ò–∞–≤–∞—Ç –æ–≤–¥–µ –∫–æ–≥–∞ —ú–µ —Å–µ –≤—á–∏—Ç–∞–∞—Ç CSV –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ');
          showPlaceholder('risk-chart', '–ú–µ—Ç—Ä–∏–∫–∏—Ç–µ –∑–∞ —Ä–∏–∑–∏–∫ —ú–µ —Å–µ –ø–æ—ò–∞–≤–∞—Ç –æ–≤–¥–µ –∫–æ–≥–∞ —ú–µ —Å–µ –≤—á–∏—Ç–∞–∞—Ç CSV –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ');
        }
      } catch (error) {
        console.error('Error initializing charts:', error);
      }
    }

    // Initialize when page loads
    window.addEventListener('DOMContentLoaded', function() {
      initializeCharts();
      
      // Add smooth animations for cards
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      // Observe all chart cards and feature cards
      document.querySelectorAll('.chart-card, .feature-card').forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        observer.observe(card);
      });

      // Update market status based on time
      function updateMarketStatus() {
        const now = new Date();
        const hour = now.getHours();
        const day = now.getDay();
        const isWeekday = day >= 1 && day <= 5;
        const isMarketHours = hour >= 9 && hour <= 16;
        
        const statusDot = document.querySelector('.status-dot');
        const statusText = document.querySelector('.market-status span');
        
        if (statusDot && statusText) {
          if (isMarketHours && isWeekday) {
            statusDot.style.background = '#10b981';
            statusText.textContent = '–ü–∞–∑–∞—Ä–∏—Ç–µ –û—Ç–≤–æ—Ä–µ–Ω–∏';
          } else if (isWeekday) {
            statusDot.style.background = '#f59e0b';
            statusText.textContent = '–ü—Ä–µ–¥/–ü–æ –†–∞–±–æ—Ç–Ω–æ –í—Ä–µ–º–µ';
          } else {
            statusDot.style.background = '#8a9bb5';
            statusText.textContent = '–ü–∞–∑–∞—Ä–∏—Ç–µ –ó–∞—Ç–≤–æ—Ä–µ–Ω–∏';
          }
        }
      }

      updateMarketStatus();
      setInterval(updateMarketStatus, 60000); // Update every minute

      // Add hover effects to stat items
      document.querySelectorAll('.stat-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
          this.style.transform = 'scale(1.05)';
          this.style.transition = 'transform 0.3s ease';
        });
        
        item.addEventListener('mouseleave', function() {
          this.style.transform = 'scale(1)';
        });
      });
    });

    // Price Change Notifications
    let priceChangeAlerts = [];
    
    function calculatePriceChanges() {
      if (!allFundData) {
        console.warn('No fund data available for price change calculation');
        return [];
      }
      
      console.log('Starting price change calculation...');
      const alerts = [];
      const now = new Date();
      const oneWeekAgo = new Date(now.getTime() - (7 * 24 * 60 * 60 * 1000));
      const oneMonthAgo = new Date(now.getTime() - (30 * 24 * 60 * 60 * 1000));
      const sixMonthsAgo = new Date(now.getTime() - (180 * 24 * 60 * 60 * 1000));
      
      let totalFunds = 0;
      
      Object.keys(allFundData).forEach(fundType => {
        Object.keys(allFundData[fundType]).forEach(fundName => {
          totalFunds++;
          const fundData = allFundData[fundType][fundName];
          if (!fundData || fundData.length < 2) {
            console.log(`Skipping ${fundName}: insufficient data (${fundData?.length || 0} points)`);
            return;
          }
          
          // Sort by timestamp to ensure we have the latest data first
          const sortedData = [...fundData].sort((a, b) => b.timestamp - a.timestamp);
          const latestPoint = sortedData[0];
          const latestPrice = latestPoint.value;
          
          // Find price points for different periods
          const weekAgoPoint = findClosestPricePoint(sortedData, oneWeekAgo.getTime());
          const monthAgoPoint = findClosestPricePoint(sortedData, oneMonthAgo.getTime());
          const sixMonthsAgoPoint = findClosestPricePoint(sortedData, sixMonthsAgo.getTime());
          
          // Calculate percentage changes
          if (weekAgoPoint) {
            const weekChange = ((latestPrice - weekAgoPoint.value) / weekAgoPoint.value) * 100;
            if (Math.abs(weekChange) >= 1) {
              alerts.push({
                fundName,
                fundType,
                period: '7 –¥–µ–Ω–∞',
                change: weekChange,
                currentPrice: latestPrice,
                previousPrice: weekAgoPoint.value,
                severity: Math.abs(weekChange) >= 3 ? 'high' : 'medium',
                icon: weekChange > 0 ? 'üìà' : 'üìâ'
              });
            }
          }
          
          if (monthAgoPoint) {
            const monthChange = ((latestPrice - monthAgoPoint.value) / monthAgoPoint.value) * 100;
            if (Math.abs(monthChange) >= 5) {
              alerts.push({
                fundName,
                fundType,
                period: '30 –¥–µ–Ω–∞',
                change: monthChange,
                currentPrice: latestPrice,
                previousPrice: monthAgoPoint.value,
                severity: Math.abs(monthChange) >= 10 ? 'high' : 'medium',
                icon: monthChange > 0 ? 'üöÄ' : 'üìâ'
              });
            }
          }
          
          if (sixMonthsAgoPoint) {
            const sixMonthChange = ((latestPrice - sixMonthsAgoPoint.value) / sixMonthsAgoPoint.value) * 100;
            if (Math.abs(sixMonthChange) >= 10) {
              alerts.push({
                fundName,
                fundType,
                period: '6 –º–µ—Å–µ—Ü–∏',
                change: sixMonthChange,
                currentPrice: latestPrice,
                previousPrice: sixMonthsAgoPoint.value,
                severity: Math.abs(sixMonthChange) >= 20 ? 'high' : 'medium',
                icon: sixMonthChange > 0 ? 'üéØ' : '‚ö°'
              });
            }
          }
        });
      });
      
      console.log(`Processed ${totalFunds} funds, found ${alerts.length} alerts`);
      
      // Sort by severity and change percentage
      return alerts.sort((a, b) => {
        if (a.severity !== b.severity) {
          return a.severity === 'high' ? -1 : 1;
        }
        return Math.abs(b.change) - Math.abs(a.change);
      });
    }
    
    function findClosestPricePoint(sortedData, targetTimestamp) {
      let closest = null;
      let minDiff = Infinity;
      
      for (const point of sortedData) {
        const diff = Math.abs(point.timestamp - targetTimestamp);
        if (diff < minDiff && point.timestamp <= targetTimestamp) {
          minDiff = diff;
          closest = point;
        }
      }
      
      return closest;
    }
    
    function displayPriceChangeAlerts() {
      const container = document.getElementById('auto-alerts');
      if (!container) {
        console.warn('Auto-alerts container not found');
        return;
      }
      
      console.log('Displaying price change alerts. Fund data available:', !!allFundData);
      console.log('Fund data keys:', Object.keys(allFundData || {}));
      
      try {
        priceChangeAlerts = calculatePriceChanges();
        console.log('Calculated alerts:', priceChangeAlerts.length);
      } catch (error) {
        console.error('Error calculating price changes:', error);
        container.innerHTML = `
          <div style="text-align: center; color: var(--accent-red); padding: 2rem;">
            –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞—ö–µ—Ç–æ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ.<br>
            <small>–í–µ –º–æ–ª–∏–º–µ –æ–±–∏–¥–µ—Ç–µ —Å–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–¥–æ—Ü–Ω–∞.</small>
          </div>
        `;
        return;
      }
      
      if (priceChangeAlerts.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
            –ù–µ–º–∞ –∑–Ω–∞—á–∞—ò–Ω–∏ –ø—Ä–æ–º–µ–Ω–∏ –Ω–∞ —Ü–µ–Ω–∏—Ç–µ.<br>
            <small>–°–µ —Å–ª–µ–¥–∞—Ç –ø—Ä–æ–º–µ–Ω–∏: 1%+ –Ω–µ–¥–µ–ª–Ω–æ, 5%+ –º–µ—Å–µ—á–Ω–æ, 10%+ –∑–∞ 6 –º–µ—Å–µ—Ü–∏</small>
          </div>
        `;
        return;
      }
      
      container.innerHTML = priceChangeAlerts.map(alert => {
        // Color based on direction and severity
        let changeColor, bgColor, borderColor;
        
        if (alert.change > 0) {
          // Positive changes - green colors
          if (alert.severity === 'high') {
            changeColor = '#059669';     // Dark green for text
            bgColor = 'rgba(16, 185, 129, 0.15)';  // Light green background
            borderColor = '#10b981';     // Medium green border
          } else {
            changeColor = '#10b981';     // Medium green for text
            bgColor = 'rgba(16, 185, 129, 0.08)';  // Very light green background
            borderColor = '#6ee7b7';     // Light green border
          }
        } else {
          // Negative changes - red colors
          if (alert.severity === 'high') {
            changeColor = '#dc2626';     // Dark red for text
            bgColor = 'rgba(239, 68, 68, 0.15)';   // Light red background
            borderColor = '#ef4444';     // Medium red border
          } else {
            changeColor = '#ef4444';     // Medium red for text
            bgColor = 'rgba(239, 68, 68, 0.08)';   // Very light red background
            borderColor = '#fca5a5';     // Light red border
          }
        }
        
        return `
          <div style="
            background: ${bgColor}; 
            border: 1px solid ${borderColor}; 
            border-radius: 8px; 
            padding: 1rem; 
            margin-bottom: 0.5rem;
            border-left: 4px solid ${borderColor};
          ">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
              <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                  <span style="font-size: 1.2rem;">${alert.icon}</span>
                  <div style="font-weight: 600; color: var(--text-primary); font-size: 0.95rem;">${alert.fundName}</div>
                </div>
                <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                  ${getFundTypeLabel(alert.fundType)} ‚Ä¢ ${alert.period}
                </div>
              </div>
              <div style="text-align: right;">
                <div style="font-weight: 700; color: ${changeColor}; font-size: 1.1rem;">
                  ${alert.change > 0 ? '+' : ''}${alert.change.toFixed(2)}%
                </div>
                ${alert.severity === 'high' ? `<div style="font-size: 0.7rem; color: ${changeColor}; font-weight: 600; opacity: 0.8;">${alert.change > 0 ? '–í–ò–°–û–ö –†–ê–°–¢' : '–í–ò–°–û–ö –ü–ê–î'}</div>` : ''}
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.8rem; color: var(--text-muted);">
              <div>–¢–µ–∫–æ–≤–Ω–∞: <span style="color: var(--text-primary); font-weight: 500;">${alert.currentPrice.toFixed(2)} –¥–µ–Ω</span></div>
              <div>–ü—Ä–µ—Ç—Ö–æ–¥–Ω–∞: <span style="color: var(--text-primary); font-weight: 500;">${alert.previousPrice.toFixed(2)} –¥–µ–Ω</span></div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function getFundTypeLabel(fundType) {
      const labels = {
        'equity': '–ê–∫—Ü–∏—Å–∫–∏',
        'bond': '–û–±–≤—Ä–∑–Ω–∏—á–∫–∏', 
        'balanced': '–ë–∞–ª–∞–Ω—Å–∏—Ä–∞–Ω',
        'money': '–ü–∞—Ä–∏—á–µ–Ω',
        'sectoral': '–°–µ–∫—Ç–æ—Ä—Å–∫–∏',
        'index': '–ò–Ω–¥–µ–∫—Å–Ω–∏'
      };
      return labels[fundType] || fundType;
    }

    // Fund Distribution Charts
    function createFundDistributionCharts() {
      if (!allFundData) {
        console.warn('No fund data available for distribution charts');
        return;
      }

      console.log('Creating fund distribution charts...');
      
      // Calculate fund type distributions
      const fundTypeData = {};
      const individualFundData = [];
      let totalValue = 0;
      
      Object.keys(allFundData).forEach(fundType => {
        let typeTotal = 0;
        const typeFunds = [];
        
        Object.keys(allFundData[fundType]).forEach(fundName => {
          const fundData = allFundData[fundType][fundName];
          if (fundData && fundData.length > 0) {
            // Get latest value
            const latestData = fundData[fundData.length - 1];
            const fundValue = latestData.value || 0;
            
            typeTotal += fundValue;
            totalValue += fundValue;
            
            typeFunds.push({
              name: fundName,
              value: fundValue,
              type: fundType
            });
            
            individualFundData.push({
              name: fundName,
              value: fundValue,
              type: fundType,
              typeLabel: getFundTypeLabel(fundType)
            });
          }
        });
        
        if (typeTotal > 0) {
          fundTypeData[fundType] = {
            total: typeTotal,
            funds: typeFunds,
            label: getFundTypeLabel(fundType)
          };
        }
      });

      // Create fund types pie chart
      createFundTypesPieChart(fundTypeData, totalValue);
      
      // Create fund summary stats
      createFundSummaryStats(fundTypeData, totalValue);
      
      // Create individual fund type distribution charts
      createFundTypeDistributionCharts(fundTypeData);
      
      // Create top funds list
      createTopFundsList(individualFundData);
    }

    function createFundTypesPieChart(fundTypeData, totalValue) {
      const labels = [];
      const values = [];
      const colors = ['#10b981', '#3b82f6', '#8b5cf6', '#f59e0b', '#ef4444', '#06b6d4']; // green, blue, purple, orange, red, cyan

      Object.keys(fundTypeData).forEach((fundType, index) => {
        labels.push(fundTypeData[fundType].label);
        values.push(fundTypeData[fundType].total);
      });

      const trace = {
        labels: labels,
        values: values,
        type: 'pie',
        hole: 0.4,
        marker: {
          colors: colors,
          line: {
            color: 'var(--bg-primary)',
            width: 2
          }
        },
        textfont: {
          color: '#f1f5f9',
          size: 12
        },
        textinfo: 'label+percent',
        textposition: 'outside'
      };

      const layout = {
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#b8c5d6' },
        showlegend: true,
        legend: {
          orientation: 'v',
          x: 1,
          y: 0.5,
          font: { color: '#b8c5d6', size: 11 }
        },
        margin: { t: 20, b: 20, l: 20, r: 100 },
        annotations: [{
          font: { size: 16, color: '#f7b801' },
          showarrow: false,
          text: `${labels.length}<br>–¢–∏–ø–æ–≤–∏`,
          x: 0.5,
          y: 0.5
        }]
      };

      Plotly.newPlot('fund-types-chart', [trace], layout, { 
        responsive: true, 
        displayModeBar: false 
      });

      // Update summary
      const summaryContainer = document.getElementById('fund-types-summary');
      if (summaryContainer) {
        const summaryText = Object.keys(fundTypeData).map(fundType => {
          const percentage = ((fundTypeData[fundType].total / totalValue) * 100).toFixed(1);
          return `${fundTypeData[fundType].label}: ${percentage}%`;
        }).join(' ‚Ä¢ ');
        
        summaryContainer.innerHTML = `–†–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞: ${summaryText}`;
      }
    }

    function createFundSummaryStats(fundTypeData, totalValue) {
      const statsContainer = document.getElementById('fund-summary-stats');
      if (!statsContainer) return;

      const typeColors = {
        'equity': '#10b981',
        'bond': '#3b82f6', 
        'balanced': '#8b5cf6',
        'money': '#f59e0b'
      };

      const typeIcons = {
        'equity': 'üìà',
        'bond': 'üèõÔ∏è', 
        'balanced': '‚öñÔ∏è',
        'money': 'üí∞'
      };

      statsContainer.innerHTML = Object.keys(fundTypeData).map(fundType => {
        const data = fundTypeData[fundType];
        const percentage = ((data.total / totalValue) * 100).toFixed(1);
        const color = typeColors[fundType] || '#6b7280';
        const icon = typeIcons[fundType] || 'üìä';

        return `
          <div style="
            background: var(--bg-primary); 
            border-radius: 12px; 
            padding: 1.25rem; 
            text-align: center;
            border-left: 4px solid ${color};
          ">
            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${icon}</div>
            <div style="font-weight: 600; color: var(--text-primary); font-size: 0.9rem; margin-bottom: 0.25rem;">
              ${data.label}
            </div>
            <div style="font-weight: 700; color: ${color}; font-size: 1.1rem; margin-bottom: 0.25rem;">
              ${data.total.toFixed(0)} –¥–µ–Ω
            </div>
            <div style="font-size: 0.8rem; color: var(--text-muted);">
              ${percentage}% ‚Ä¢ ${data.funds.length} —Ñ–æ–Ω–¥${data.funds.length > 1 ? '–æ–≤–∏' : ''}
            </div>
          </div>
        `;
      }).join('');

      // Update total value badge
      const totalValueBadge = document.getElementById('total-value-badge');
      if (totalValueBadge) {
        totalValueBadge.textContent = `${totalValue.toFixed(0)} –¥–µ–Ω –≤–∫—É–ø–Ω–æ`;
      }
    }

    function createFundTypeDistributionCharts(fundTypeData) {
      const typeColors = {
        'equity': '#10b981',
        'bond': '#3b82f6', 
        'balanced': '#8b5cf6',
        'money': '#f59e0b',
        'sectoral': '#ef4444',
        'index': '#06b6d4'
      };

      Object.keys(fundTypeData).forEach(fundType => {
        const data = fundTypeData[fundType];
        const chartId = `${fundType}-distribution-chart`;
        const summaryId = `${fundType}-distribution-summary`;
        const countBadgeId = `${fundType}-count-badge`;
        
        // Update count badge
        const countBadge = document.getElementById(countBadgeId);
        if (countBadge) {
          countBadge.textContent = `${data.funds.length} —Ñ–æ–Ω–¥${data.funds.length > 1 ? '–æ–≤–∏' : ''}`;
        }

        if (data.funds.length === 0) {
          document.getElementById(chartId).innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-muted); text-align: center;">
              –ù–µ–º–∞ —Ñ–æ–Ω–¥–æ–≤–∏ –æ–¥ –æ–≤–æ—ò —Ç–∏–ø
            </div>
          `;
          return;
        }

        // Sort funds by value
        const sortedFunds = data.funds.sort((a, b) => b.value - a.value);
        
        const labels = sortedFunds.map(fund => {
          // Shorten long names for better display
          return fund.name.length > 25 ? fund.name.substring(0, 22) + '...' : fund.name;
        });
        const values = sortedFunds.map(fund => fund.value);
        
        // Create color variations of the main type color
        const baseColor = typeColors[fundType];
        const colors = sortedFunds.map((_, index) => {
          const opacity = 1 - (index * 0.15); // Gradually lighter colors
          return baseColor + Math.floor(Math.max(0.3, opacity) * 255).toString(16).padStart(2, '0');
        });

        const trace = {
          labels: labels,
          values: values,
          type: 'pie',
          hole: 0.3,
          marker: {
            colors: colors,
            line: {
              color: 'var(--bg-primary)',
              width: 1
            }
          },
          textfont: {
            color: '#f1f5f9',
            size: 9
          },
          textinfo: 'percent',
          textposition: 'auto'
        };

        const layout = {
          paper_bgcolor: 'rgba(0,0,0,0)',
          plot_bgcolor: 'rgba(0,0,0,0)',
          font: { color: '#b8c5d6' },
          showlegend: false,
          margin: { t: 10, b: 10, l: 10, r: 10 },
          annotations: [{
            font: { size: 12, color: baseColor },
            showarrow: false,
            text: `${sortedFunds.length}<br>—Ñ–æ–Ω–¥${sortedFunds.length > 1 ? '–æ–≤–∏' : ''}`,
            x: 0.5,
            y: 0.5
          }]
        };

        Plotly.newPlot(chartId, [trace], layout, { 
          responsive: true, 
          displayModeBar: false 
        });

        // Update summary
        const summaryContainer = document.getElementById(summaryId);
        if (summaryContainer && sortedFunds.length > 0) {
          const topFund = sortedFunds[0];
          const topPercentage = ((topFund.value / data.total) * 100).toFixed(1);
          summaryContainer.innerHTML = `–ù–∞—ò–≥–æ–ª–µ–º: ${topFund.name.length > 20 ? topFund.name.substring(0, 20) + '...' : topFund.name} (${topPercentage}%)`;
        }
      });
    }

    function createTopFundsList(individualFundData) {
      const container = document.getElementById('top-funds-list');
      if (!container) return;

      const sortedFunds = individualFundData.sort((a, b) => b.value - a.value);
      const topFunds = sortedFunds.slice(0, 8); // Top 8 funds

      container.innerHTML = topFunds.map((fund, index) => {
        const typeColors = {
          'equity': '#10b981',
          'bond': '#3b82f6', 
          'balanced': '#8b5cf6',
          'money': '#f59e0b',
          'sectoral': '#ef4444',
          'index': '#06b6d4'
        };

        const color = typeColors[fund.type] || '#6b7280';
        const totalValue = individualFundData.reduce((sum, f) => sum + f.value, 0);
        const percentage = ((fund.value / totalValue) * 100).toFixed(1);

        return `
          <div style="
            background: var(--bg-primary); 
            border-radius: 12px; 
            padding: 1.5rem; 
            border-left: 4px solid ${color};
            transition: transform 0.3s ease;
          " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
              <div style="font-weight: 600; color: var(--text-primary); font-size: 1rem;">#${index + 1}</div>
              <div style="background: ${color}; color: white; padding: 0.25rem 0.75rem; border-radius: 8px; font-size: 0.8rem; font-weight: 600;">
                ${fund.typeLabel}
              </div>
            </div>
            <div style="font-weight: 700; color: var(--text-primary); font-size: 1.1rem; margin-bottom: 0.5rem; line-height: 1.3;">
              ${fund.name}
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div style="font-size: 1.2rem; font-weight: 700; color: ${color};">
                ${fund.value.toFixed(2)} –¥–µ–Ω
              </div>
              <div style="font-size: 0.9rem; color: var(--text-muted);">
                ${percentage}%
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Initialize notifications when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Wait for fund data to be loaded
      setTimeout(() => {
        console.log('Attempting to display price change alerts...');
        displayPriceChangeAlerts();
      }, 5000);
    });    // Update price change alerts when fund data is loaded
    function updateNotificationsAfterDataLoad() {
      console.log('Updating notifications after data load...');
      setTimeout(() => {
        console.log('Fund data should be loaded, displaying alerts...');
        displayPriceChangeAlerts();
      }, 1000);
    }

    })(); // Close the IIFE

  </script>
</body>
</html>